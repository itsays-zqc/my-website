#  Max-Optics SDK

By referring to the relevant instructions in the Max-Optics SDK, you will be able to efficiently complete the simulation calculations for the desired models. Our directory is categorized based on functionalities, allowing you to easily locate the required instructions within the corresponding functional areas. 

Furthermore, we also provide the capability to search for instructions in the search box, enabling you to quickly locate relevant explanations. Through these features, you can conveniently access the necessary information to support your simulation work. We appreciate your choice of using our Max-Optics SDK, and we look forward to providing you with a convenient and effective tool for your needs.



# Code Command



## 1. Material

The purpose of this section of code instructions is to assist you in adding the required simulation materials to meet your simulation needs. We can use this module with code `mt = pj.Material() `. 

These instructions enable you to incorporate dispersion/non-dispersion materials and anisotropic materials into the simulation. Additionally, you have the option to directly access the necessary materials from the Max-Optics material library.



### 1.1 add_anisotropy

Add a project non-dispersion material.

```python
add_anisotropy(
            self,
            *,
            name: str,
            data: List[
                Tuple[
                    float, float, float, float, float, float, float, float, float, float, float, float, float, float, float, float, float, float, float],
            ],
            color: Optional[str] = None,
            alpha: Optional[float] = None,
            fitting: Literal[None, "linear"],
            order: int = 2,
   			)
```

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|      name      |                        Material name.                        |
|      data      | Material data. Format is [(wavelength, xx index real, xx index imag, yy index real, yy index imag, zz index real, zz index imag), …] or [(wavelength, xx index real, xx index imag, xy index real, xy index imag, …), …]. |
|     color      | Material color. If not filled, color will be calculated from index parameters. |
|    fitting     |                    Material fitting mode.                    |
|     order      |                     Material mesh order.                     |

**Example:**

```python
mt = pj.Material()
mt.add_anisotropy(name="LN", fitting=None,
      data=[(wavelength * 1e-6, 2.211, 0, 2.138, 0, 2.211, 0)], order=2
      )
```



### 1.2 add_dispersion

Add a project dispersion material.

```python
add_dispersion(
            self,
            *,
            name: str,
            data: List[
                Tuple[float, float, float],
            ],
            color: Optional[str] = None,
            alpha: Optional[float] = None,
            fitting: Literal[None, "linear"],
            order: int = 2
			)
```

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|      name      |                        Material name.                        |
|      data      | Material data. Format is [(wavelength, index real, index imag), …]. |
|     color      | Material color. If not filled, color will be calculated from index parameters. |
|    fitting     |                    Material fitting mode.                    |
|     order      |                     Material mesh order.                     |

**Example:**

```python
mt = pj.Material()
mt.add_dispersion(name="SiO2",
    data=[(1.55e-06, 1.444, 0), (1.30e-06, 1.81, 0.227)], order=1
    )
```



### 1.3 add_lib

Add a project material with existing material in library.

```python
add_lib(
            self,
            *,
            name: str,
            data: Any,
            override: Optional[dict]=None,
            color: Optional[str] = None,
            alpha: Optional[float] = None,
            order: int = 2
            )
```

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|      name      |                        Material name.                        |
|      data      |               A existing material in library.                |
|    override    |                          override.                           |
|     color      | Material color. If not filled, color will be calculated from index parameters. |
|     order      |                     Material mesh order.                     |

**Example:**

```python
mt = pj.Material()
mt.add_lib(name="Air", data=mo.Material.Air, order=2)
```



### 1.4 add_nondispersion

Add a project non-dispersion material.

```python
add_nondispersion(
        self,
        *,
        name: str,
        data: List[Tuple[float, float]],
        color: Optional[str] = None,
        alpha: Optional[float] = None,
        order: int = 2
		)
```

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|    **name**    |                        Material name.                        |
|    **data**    |     Material data. Format is [(index real, index imag)].     |
|   **color**    | Material color. If not filled, color will be calculated from index parameters. |
|   **order**    |                     Material mesh order.                     |

**Example:**

```python
mt = pj.Material()
mt.add_nondispersion(name="SiO2", data=[(1.444, 0)], order=1)
```



## 2. Structure

The code within the "Structure" section is designed to assist you in incorporating the necessary structures and doping characteristics during the simulation process. 

```python
st = pj.Structure(mesh_type, 
                  mesh_factor,
                  background_material
                 )
```

|   **Parameters**    |  Default   |   Type   |                    Notes                    |
| :-----------------: | :--------: | :------: | :-----------------------------------------: |
|      mesh_type      | curve_mesh |  string  | Selections are ['curve_mesh', 'staircase']. |
|     mesh_factor     |    1.2     |  float   |   Restrained by condition: >=1.05,<=1.6.    |
| background_material |            | material |                                             |

You can create models using GDS format files and also utilize various methods such as Bézier curves, tapering, and circular rings for structural modeling.



### 2.1 Add doping

Add a project doping property. We provide support for importing doping data from files and customizing doping regions.

```python
add_doping(
            self,
            *,
            name: str,
            type: "StructureDopingTypeSelection",
            property: "StructureDopingPropertyDict"
			)
```

| **Parameters** |   Description   |
| :------------: | :-------------: |
|      name      |   Doping name   |
|      type      |   Doping type   |
|    property    | Doping property |

For instance, the code for importing doping from a file is demonstrated as follows.

```python
st.add_doping(name="import_n", type="file", property={
    "general": {"format": "DOP", "file_path": n_dop_file, "species": "n"}})
```

You can configure parameters related to importing doping files by adjusting settings under the `property.general` sections.

|    **Parameters**    | Default | Type |                    Notes                     |
| :------------------: | :-----: | :--: | :------------------------------------------: |
|    general.format    |         | str  |            Selections are ['DOP']            |
|  general.file_path   |         | str  |                                              |
|   general.species    |         | str  |          Selections are ['n', 'p']           |
|  volume.volume_type  |  'all'  | str  | Selections are ['all', 'material', 'region'] |
| volume.material_list |         | list |   Available when volume_type is 'material'   |
|  volume.region_list  |         | list |    Available when volume_type is 'region'    |

The code for utilizing custom region doping is provided below.

```python
st.add_doping(name="Uniform", type="p", property={
    "geometry": {"x": p_uniform_x_center, "x_span": p_uniform_x_span,
                 "y": p_uniform_y_center, "y_span": p_uniform_y_span,
                 "z": p_uniform_z_center, "z_span": p_uniform_z_span},
    "general": {"distribution_function": "constant", "concentration": p_uniform_con},
    "volume": {"volume_type": "material", "material_list": [mt["mat_si"]]}})
```

|        **Parameters**         | Default | Type  |                       Notes                        |
| :---------------------------: | :-----: | :---: | :------------------------------------------------: |
|          geometry.x           |         | float |                                                    |
|        geometry.x_span        |         | float |                                                    |
|          geometry.y           |         | float |                                                    |
|        geometry.y_span        |         | float |                                                    |
|          geometry.z           |         | float |                                                    |
|        geometry.z_span        |         | float |                                                    |
|       geometry.rotate_x       |         | float |                                                    |
|       geometry.rotate_y       |         | float |                                                    |
|       geometry.rotate_z       |         | float |                                                    |
|        geometry.x_min         |         | float |                                                    |
|        geometry.x_max         |         | float |                                                    |
|        geometry.y_min         |         | float |                                                    |
|        geometry.y_max         |         | float |                                                    |
|        geometry.z_min         |         | float |                                                    |
|        geometry.z_max         |         | float |                                                    |
| general.distribution_function |         |  str  |      Selections are ['constant', 'gaussian']       |
|     general.concentration     |         | float |                                                    |
|      general.source_face      |         |  str  | Available when distribution_function is 'gaussian' |
|    general.junction_width     |         | float | Available when distribution_function is 'gaussian' |
|   general.ref_concentration   |         | float | Available when distribution_function is 'gaussian' |
|      volume.volume_type       |  'all'  |  str  |    Selections are ['all', 'material', 'region']    |
|     volume.material_list      |         | list  |      Available when volume_type is 'material'      |
|      volume.region_list       |         | list  |       Available when volume_type is 'region'       |



### 2.2 Add electrode

Add an electrode to current project.

```python
add_electrode(
            self,
            *,
            name: str,
            property: StructureElectrodeProperty,
    )
```

| **Parameters** |              Description              |
| :------------: | :-----------------------------------: |
|      name      |   Electric boundary condition name.   |
|    property    | Electric boundary condition property. |

#### **2.2.1 Example: steady state **

```python
st = pj.Structure()
st.add_electrode(name="anode", property={
    "solid": "Anode", "bc_mode": "steady_state", "sweep_type": "range",
    "range_start": tcad_vmin, "range_stop": tcad_vmax, "range_interval": tcad_vstep, "apply_AC_small_signal": "none"})
st.add_electrode(name="cathode", property={
    "solid": "Cathode", "bc_mode": "steady_state",
    "sweep_type": "single", "voltage": 0, "apply_AC_small_signal": "none"})
```

|       **Parameters**       |   Default    |  Type   |                    Notes                     |
| :------------------------: | :----------: | :-----: | :------------------------------------------: |
|        force_ohmic         |     true     |  bool   |                                              |
|          bc_mode           | steady_state | string  |       Selections are ['steady_state'].       |
|   apply_AC_small_signal    |     none     | string  |           Selections are ['none'].           |
|         sweep_type         |    single    | string  | Selections are ['single', 'range', 'value']. |
|         v_step_max         |     0.5      |  float  |                                              |
|          voltage           |      0       |  float  |    Available when sweep_type is 'single'     |
|        range_start         |      0       |  float  |     Available when sweep_type is 'range'     |
|         range_stop         |      1       |  float  |     Available when sweep_type is 'range'     |
|       range_interval       |      1       |  float  |     Available when sweep_type is 'range'     |
|      range_num_points      |      2       | integer |     Available when sweep_type is 'range'     |
| []sweep_value_table.index  |              | integer |    Available when sweep_type is 'value'.     |
| []sweep_value_table.number |              |  float  |    Available when sweep_type is 'value'.     |
|        surface_type        |    solid     | string  |          Selections are ['solid'].           |
|           solid            |              | string  |                                              |



#### **2.2.2 Example: transient **

```python
st = pj.Structure()
st.add_electrode(name="cathode", property={
    "solid": "Cathode", "bc_mode": "transient", "voltage": tcad_vbias, "v_step_max": 0.5,
    "time_table": [{"time_start": 0, "time_stop": 2e-12, "initial_step": 1e-12, "max_step": 5e-12},
                   {"time_start": 2e-12, "time_stop": 2.001e-12, "initial_step": 30e-18, "max_step": 30e-18,
                    "optical": {"enabled": 1, "envelop": 0, "source_fraction": source_fraction}},
                   {"time_start": 2.001e-12, "time_stop": 2.01e-12, "initial_step": 30e-18, "max_step": 60e-18,
                    "optical": {"enabled": 1, "envelop": 0, "source_fraction": source_fraction}},
                   {"time_start": 2.01e-12, "time_stop": 2.03e-12, "initial_step": 60e-18, "max_step": 2e-15,
                    "optical": {"enabled": 1, "envelop": 0, "source_fraction": source_fraction}},
                   {"time_start": 2.03e-12, "time_stop": 10e-12, "initial_step": 2e-15, "max_step": 50e-15,
                    "optical": {"enabled": 1, "envelop": 0, "source_fraction": source_fraction}},
                   {"time_start": 10e-12, "time_stop": 500e-12, "initial_step": 50e-15, "max_step": 10e-12,
                    "optical": {"enabled": 1, "envelop": 0, "source_fraction": source_fraction}}]})

st.add_electrode(name="anode", property={
    "solid": "Anode", "bc_mode": "steady_state",
    "sweep_type": "single", "voltage": 0, "apply_AC_small_signal": "none"})

```

|            **Parameters**            | Default |  Type   |             Notes             |
| :----------------------------------: | :-----: | :-----: | :---------------------------: |
|             force_ohmic              |  true   |  bool   |                               |
|               bc_mode                |         | string  | Selections are ['transient']. |
|               voltage                |    0    |  float  |                               |
|       []time_table.time_start        |         |  float  |                               |
|        []time_table.time_stop        |         |  float  |                               |
|      []time_table.initial_step       |         |  float  |                               |
|        []time_table.max_step         |         |  float  |                               |
|     []time_table.optical.enabled     |    0    | integer |     Selections are [0, 1]     |
|     []time_table.optical.envelop     |         | integer |      Selections are [0]       |
| []time_table.optical.source_fraction |         |  float  |                               |
|             surface_type             |  solid  | string  |   Selections are ['solid'].   |
|                solid                 |         | string  |                               |







### 2.3 Add surface recombination

Add surface recombination.

```python
add_surface_recombination(
            self,
            *,
            name: str,
            property: AddSurfaceRecombination,
    )
```

| **Parameters** |           Description           |
| :------------: | :-----------------------------: |
|      name      |   Surface recombination name.   |
|    property    | Surface recombination property. |

**Example:**

```python
st.add_surface_recombination(name="Cathode_Si", property={
        "surface_type": "domain_domain", "interface_type": "MetalOhmicInterface",
        "domain_1": "Cathode", "domain_2": "Si_base", "infinite_recombination": False, "velocity_electron": 1e7, "velocity_hole": 1e7})
```

|     **Parameters**     |    Default    |   Type   |                            Notes                             |
| :--------------------: | :-----------: | :------: | :----------------------------------------------------------: |
|      surface_type      | domain_domain |  string  |    Selections are ['domain_domain', 'material_material'].    |
|     interface_type     |     null      |  string  | Selections are ['null', 'InsulatorInterface', 'HomoJunction', 'HeteroJunction', 'MetalOhmicInterface', 'SolderPad']. |
| infinite_recombination |     true      |   bool   |    Available when interface_type is 'MetalOhmicInterface'    |
|     velocity_hole      |       0       |  float   | Available when interface_type is 'MetalOhmicInterface'/'InsulatorInterface' |
|   velocity_electron    |       0       |  float   | Available when interface_type is 'MetalOhmicInterface'/'InsulatorInterface' |
|        domain_1        |               |  string  |        Available when surface_type is 'domain_domain'        |
|        domain_2        |               |  string  |        Available when surface_type is 'domain_domain'        |
|       material_1       |               | material |      Available when surface_type is 'material_material'      |
|       material_2       |               | material |      Available when surface_type is 'material_material'      |



### 2.4 Add geometry

Add a geometry(structure) to current project.

```python
add_geometry(
            self, *,
            name: str,
            type: str,
            property: "StructureGeometryPropertyDict"
    )
```

| **Parameters** |    Description     |
| :------------: | :----------------: |
|      name      |   Geometry name.   |
|      type      |   Geometry type.   |
|    property    | Geometry property. |

#### 2.2.1 GDS file/GDS file3D

The following code supports the import of GDS layout files.

**Example:**

```python
st.add_geometry(name="gds_file", type="gds_file", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"x": 3 * space, "y": 2 * space, "z": 0, "z_span": wg_height},
    "general": {"path": gds_file, "cell_name": "EXTEND_1", "layer_name": (3, 0)}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
|     geometry.x      |    0    |  float   |                               |
|     geometry.y      |    0    |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |
|    general.path     |         |  string  |                               |
|  general.cell_name  |         |  string  |                               |
| general.layer_name  |         |   list   |                               |

Meanwhile, we also offer support for basic operations on GDS layout modeling using `type="gds_file3D"`. The code for this is provided below:

```python
st.add_geometry(name="gds_file_3D", type="gds_file3D", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "general": {"path": gds_file, "cell_name": "EXTEND_1", "layer_name": (3, 0)},
    "geometry": {"tilt_angle": 60,"tilt_location": "bottom",
                 "x": 4*space, "y": 2*space, "z": 0.05, "z_span": 0.1,
                 "mirror_normal_z": 0,"mirror_plane_z0": 0,"rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|      **Parameters**      | Default |   Type   |                            Notes                             |
| :----------------------: | :-----: | :------: | :----------------------------------------------------------: |
|        geometry.x        |    0    |  float   |                                                              |
|        geometry.y        |    0    |  float   |                                                              |
|        geometry.z        |         |  float   |                                                              |
|     geometry.z_span      |         |  float   |                 Restrained by condition: >0.                 |
|      geometry.z_min      |         |  float   |                                                              |
|      geometry.z_max      |         |  float   |                                                              |
|   geometry.tilt_angle    |   90    |  float   |                                                              |
|  geometry.tilt_location  |   top   |  string  | Selections are ['top', 'TOP', 'Top', 'bottom', 'BOTTOM', 'Bottom', 'middle', 'MIDDLE', 'Middle', 'user_defined']. |
|  geometry.user_defined   |    1    |  float   |                                                              |
| geometry.mirror_normal_z |    0    |  float   |                                                              |
| geometry.mirror_plane_z0 |    0    |  float   |                                                              |
|    geometry.rotate_x     |    0    |  float   |                                                              |
|    geometry.rotate_y     |    0    |  float   |                                                              |
|    geometry.rotate_z     |    0    |  float   |                                                              |
|    material.material     |         | material |                                                              |
|   material.mesh_order    |         | integer  |                Restrained by condition: >=0.                 |
|       general.path       |         |  string  |                                                              |
|    general.cell_name     |         |  string  |                                                              |
|    general.layer_name    |         |   list   |                                                              |
| general.construct_method |         |  string  |            Selections are ['method1', 'method2']             |



#### 2.2.2 Arc waveguide/Arc waveguide 3D

To create an arc waveguide within the project using code  `type="ArcWaveguide"`.

**Example:**

```python
st.add_geometry(name="arc", type="ArcWaveguide", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"inner_radius": size-wg_width/2, "outer_radius": size+wg_width/2, "angle": 90,
                 "x": 0, "y": 0, "z": 0, "z_span": wg_height, "rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|    **Parameters**     | Default |   Type   |             Notes             |
| :-------------------: | :-----: | :------: | :---------------------------: |
| geometry.inner_radius |         |  float   | Restrained by condition: >0.  |
| geometry.outer_radius |         |  float   | Restrained by condition: >0.  |
|    geometry.angle     |         |  float   |                               |
|      geometry.x       |         |  float   |                               |
|      geometry.y       |         |  float   |                               |
|      geometry.z       |         |  float   |                               |
|    geometry.z_span    |         |  float   | Restrained by condition: >0.  |
|    geometry.z_min     |         |  float   |                               |
|    geometry.z_max     |         |  float   |                               |
|   geometry.rotate_x   |    0    |  float   |                               |
|   geometry.rotate_y   |    0    |  float   |                               |
|   geometry.rotate_z   |    0    |  float   |                               |
|   material.material   |         | material |                               |
|  material.mesh_order  |         | integer  | Restrained by condition: >=0. |

Similarly, we offer support for using code  `type="ArcWaveguide3D"` to adjust the arc waveguide structure in the thickness direction.

```python
st.add_geometry(name="arc_3d", type="ArcWaveguide3D", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"radius": size, "angle": 180, "base_height": wg_height,
                 "top_width": wg_width_top, "bottom_width": wg_width,
                 "x": space, "y": 0, "z": 0, "rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|    **Parameters**     | Default |   Type   |               Notes                |
| :-------------------: | :-----: | :------: | :--------------------------------: |
|    geometry.radius    |         |  float   |    Restrained by condition: >0.    |
|    geometry.angle     |         |  float   | Restrained by condition: >0,<=360. |
| geometry.base_height  |         |  float   |    Restrained by condition: >0.    |
|  geometry.top_width   |         |  float   |    Restrained by condition: >0.    |
| geometry.bottom_width |         |  float   |    Restrained by condition: >0.    |
|      geometry.x       |         |  float   |                                    |
|      geometry.y       |         |  float   |                                    |
|      geometry.z       |         |  float   |                                    |
|    geometry.z_min     |         |  float   |                                    |
|    geometry.z_max     |         |  float   |                                    |
|   geometry.rotate_x   |    0    |  float   |                                    |
|   geometry.rotate_y   |    0    |  float   |                                    |
|   geometry.rotate_z   |    0    |  float   |                                    |
|   material.material   |         | material |                                    |
|  material.mesh_order  |         | integer  |   Restrained by condition: >=0.    |

#### 2.2.3 Bézier curve/ Bézier curve 3D

In the project, add a Bézier curve structure using code `type="BezierCurve"`.

**Example:**

```python
st.add_geometry(name="bezier", type="BezierCurve", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"x": 2*space, "y": 0, "z": 0, "z_span": wg_height, "width": wg_width,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "point_1_x": 0, "point_1_y": 0, "point_2_x": 0, "point_2_y": size/2,
                 "point_3_x": size, "point_3_y": size/2, "point_4_x": size, "point_4_y": size}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
| geometry.point_1_x  |         |  float   |                               |
| geometry.point_1_y  |         |  float   |                               |
| geometry.point_2_x  |         |  float   |                               |
| geometry.point_2_y  |         |  float   |                               |
| geometry.point_3_x  |         |  float   |                               |
| geometry.point_3_y  |         |  float   |                               |
| geometry.point_4_x  |         |  float   |                               |
| geometry.point_4_y  |         |  float   |                               |
|   geometry.width    |         |  float   |                               |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |

Similarly, we offer support for using code  `type="BezierCurve3D"` to adjust the Bézier curve structure in the thickness direction.

```python
st.add_geometry(name="bezier_3d", type="BezierCurve3D", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"x": 3*space, "y": 0, "z": 0, "rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "base_height": wg_height, "top_width": wg_width_top, "bottom_width": wg_width,
                 "control_points":
                     [{"x": 0, "y": 0}, {"x": 0, "y": size/2}, {"x": size, "y": size/2}, {"x": size, "y": size}]}})
```

|       **Parameters**        | Default |   Type   |             Notes             |
| :-------------------------: | :-----: | :------: | :---------------------------: |
|    geometry.base_height     |         |  float   | Restrained by condition: >0.  |
|     geometry.top_width      |         |  float   | Restrained by condition: >0.  |
|    geometry.bottom_width    |         |  float   | Restrained by condition: >0.  |
| geometry.[]control_points.x |         |  float   |                               |
| geometry.[]control_points.y |         |  float   |                               |
|         geometry.x          |         |  float   |                               |
|         geometry.y          |         |  float   |                               |
|         geometry.z          |         |  float   |                               |
|       geometry.z_min        |         |  float   |                               |
|       geometry.z_max        |         |  float   |                               |
|      geometry.rotate_x      |    0    |  float   |                               |
|      geometry.rotate_y      |    0    |  float   |                               |
|      geometry.rotate_z      |    0    |  float   |                               |
|      material.material      |         | material |                               |
|     material.mesh_order     |         | integer  | Restrained by condition: >=0. |



#### 2.2.4 Circle

Add a circular structure into the simulation project with `type="Circle"` .

**Example:**

```python
st.add_geometry(name="circle", type="Circle", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "radius": size, "x": 4*space, "y": 0, "z": 0, "z_span": wg_height}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
|   geometry.radius   |         |  float   | Restrained by condition: >0.  |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



#### 2.2.5 Custom polygon

With the code `type="CustomPolygon"` , we can add a custom polygon to the project.

**Example:**

```python
st.add_geometry(name="custom_polygon", type="CustomPolygon", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"size": size, "sides": 6,
                 "x": 4*space, "y": space, "z": 0, "z_span": wg_height,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
|    geometry.size    |         |  float   | Restrained by condition: >0.  |
|   geometry.sides    |         | integer  | Restrained by condition: >=3. |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



#### 2.2.6 Ellipse

Add an ellipse into the project using code `type="Ellipse"`.

**Example:**

```python
st.add_geometry(name="ellipse", type="Ellipse", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"x_radius": size, "y_radius": 1.5*size,
                 "x": 3*space, "y": space, "z": 0, "z_span": wg_height,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
|  geometry.x_radius  |         |  float   | Restrained by condition: >0.  |
|  geometry.y_radius  |         |  float   | Restrained by condition: >0.  |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



#### 2.2.7 Linear trapezoid

Add a linear trapezoid into the project using code `type="LinearTrapezoid"`.

**Example:**

```python
st.add_geometry(name="linear_trapezoid", type="LinearTrapezoid", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"point_1_x": 0, "point_1_y": 0, "point_2_x": 0, "point_2_y": size/2,
                 "point_3_x": size, "point_3_y": size, "point_4_x": size, "point_4_y": 0,
                 "x": 2*space, "y": space, "z": 0, "z_span": wg_height,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
| geometry.point_1_x  |         |  float   |                               |
| geometry.point_1_y  |         |  float   |                               |
| geometry.point_2_x  |         |  float   |                               |
| geometry.point_2_y  |         |  float   |                               |
| geometry.point_3_x  |         |  float   |                               |
| geometry.point_3_y  |         |  float   |                               |
| geometry.point_4_x  |         |  float   |                               |
| geometry.point_4_y  |         |  float   |                               |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



#### 2.2.8 Pyramid

Add a pyramid into the project using code `type="Pyramid"`.

**Example:**

```python
st.add_geometry(name="pyramid", type="Pyramid", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "x": space, "y": space, "z": 0, "z_span": wg_height, "theta_x": 0, "theta_y": 0,
                 "x_span_bottom": 2*size, "x_span_top": size, "y_span_bottom": 2*size, "y_span_top": size}})
```

|     **Parameters**     | Default |   Type   |             Notes             |
| :--------------------: | :-----: | :------: | :---------------------------: |
| geometry.x_span_bottom |         |  float   | Restrained by condition: >=0. |
| geometry.y_span_bottom |         |  float   | Restrained by condition: >=0. |
|  geometry.x_span_top   |         |  float   | Restrained by condition: >=0. |
|  geometry.y_span_top   |         |  float   | Restrained by condition: >=0. |
|    geometry.theta_x    |    0    |  float   |                               |
|    geometry.theta_y    |    0    |  float   |                               |
|       geometry.x       |         |  float   |                               |
|       geometry.y       |         |  float   |                               |
|       geometry.z       |         |  float   |                               |
|    geometry.z_span     |         |  float   | Restrained by condition: >0.  |
|     geometry.z_min     |         |  float   |                               |
|     geometry.z_max     |         |  float   |                               |
|   geometry.rotate_x    |    0    |  float   |                               |
|   geometry.rotate_y    |    0    |  float   |                               |
|   geometry.rotate_z    |    0    |  float   |                               |
|   material.material    |         | material |                               |
|  material.mesh_order   |         | integer  | Restrained by condition: >=0. |



#### 2.2.9 Analytical waveguide 

Add an analytical waveguide  into the project using code `type='AnalyticalWaveguide'`.

**Example:**

```python
st.add_geometry(name='taper_symmetric_test', type='AnalyticalWaveguide',
                property={'geometry': {'x': 0, 'x_span': L, 'y': 0, 'y_span': taper_width, 'z': 0, 'z_span': 0.22,
                                       'equation1': f'{str(A)}*({str(L/2)}-x)^{str(m)}+1.5', 'nonsymmetric': False,
                                       'tilt_location': 'user_defined', 'tilt_angle': 80, 'user_defined': 0.5, 'resolution': 1000},
                          'material': {'material': mt['Si'], 'mesh_order': 2}})
```

|     **Parameters**     | Default |   Type   |                            Notes                             |
| :--------------------: | :-----: | :------: | :----------------------------------------------------------: |
|    geometry.x_span     |         |  float   |                 Restrained by condition: >0.                 |
|     geometry.x_min     |         |  float   |                                                              |
|     geometry.x_max     |         |  float   |                                                              |
|    geometry.y_span     |         |  float   |                 Restrained by condition: >0.                 |
|     geometry.y_min     |         |  float   |                                                              |
|     geometry.y_max     |         |  float   |                                                              |
|   geometry.equation1   |         |  string  |                                                              |
|   geometry.equation2   |    1    |  string  |                                                              |
| geometry.nonsymmetric  |  false  |   bool   |                                                              |
|  geometry.resolution   |   10    | integer  |                                                              |
|  geometry.tilt_angle   |   90    |  float   |                                                              |
| geometry.tilt_location |   top   |  string  | Selections are ['top', 'TOP', 'Top', 'bottom', 'BOTTOM', 'Bottom', 'middle', 'MIDDLE', 'Middle', 'user_defined']. |
| geometry.user_defined  |    1    |  float   |                                                              |
|       geometry.x       |         |  float   |                                                              |
|       geometry.y       |         |  float   |                                                              |
|       geometry.z       |         |  float   |                                                              |
|    geometry.z_span     |         |  float   |                 Restrained by condition: >0.                 |
|     geometry.z_min     |         |  float   |                                                              |
|     geometry.z_max     |         |  float   |                                                              |
|   geometry.rotate_x    |    0    |  float   |                                                              |
|   geometry.rotate_y    |    0    |  float   |                                                              |
|   geometry.rotate_z    |    0    |  float   |                                                              |
|   material.material    |         | material |                                                              |
|  material.mesh_order   |         | integer  |                Restrained by condition: >=0.                 |



#### 2.2.10 Rectangle

Add a rectangle into the project using code `type="Rectangle"`.

**Example:**

```python
st.add_geometry(name="rectangle", type="Rectangle", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "x": 0, "x_span": size, "y": space, "y_span": wg_width, "z": 0, "z_span": wg_height, }})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
|   geometry.x_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.x_min    |         |  float   |                               |
|   geometry.x_max    |         |  float   |                               |
|   geometry.y_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.y_min    |         |  float   |                               |
|   geometry.y_max    |         |  float   |                               |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



#### 2.2.11 Ring

Add a ring into the project using code `type="Ring"`.

**Example:**

```python
st.add_geometry(name="ring", type="Ring", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"x": 0, "y": 2*space, "z": 0, "z_span": wg_height,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "inner_radius": size-wg_width/2, "outer_radius": size+wg_width/2,}})
```

|    **Parameters**     | Default |   Type   |             Notes             |
| :-------------------: | :-----: | :------: | :---------------------------: |
| geometry.inner_radius |         |  float   | Restrained by condition: >0.  |
| geometry.outer_radius |         |  float   | Restrained by condition: >0.  |
|      geometry.x       |         |  float   |                               |
|      geometry.y       |         |  float   |                               |
|      geometry.z       |         |  float   |                               |
|    geometry.z_span    |         |  float   | Restrained by condition: >0.  |
|    geometry.z_min     |         |  float   |                               |
|    geometry.z_max     |         |  float   |                               |
|   geometry.rotate_x   |    0    |  float   |                               |
|   geometry.rotate_y   |    0    |  float   |                               |
|   geometry.rotate_z   |    0    |  float   |                               |
|   material.material   |         | material |                               |
|  material.mesh_order  |         | integer  | Restrained by condition: >=0. |



#### 2.2.12 Sector

Add a sector into the project using code `type="Sector"`.

**Example:**

```python
st.add_geometry(name="sector", type="Sector", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"radius": size, "angle": 75,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0,
                 "x": space, "y": 2*space, "z": 0, "z_span": wg_height}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
|   geometry.radius   |         |  float   | Restrained by condition: >0.  |
|   geometry.angle    |         |  float   |                               |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



#### 2.2.13 Triangle

Add a triangle into the project using code `type="Triangle"`.

**Example:**

```python
st.add_geometry(name="triangle", type="Triangle", property={
    "material": {"material": mt["Si"], "mesh_order": 2},
    "geometry": {"point_1_x": 0, "point_1_y": 0, "point_2_x": 0, "point_2_y": size,
                 "point_3_x": size, "point_3_y": size,
                 "x": 2*space, "y": 2*space, "z": 0, "z_span": wg_height,
                 "rotate_x": 0, "rotate_y": 0, "rotate_z": 0}})
```

|   **Parameters**    | Default |   Type   |             Notes             |
| :-----------------: | :-----: | :------: | :---------------------------: |
| geometry.point_1_x  |         |  float   |                               |
| geometry.point_1_y  |         |  float   |                               |
| geometry.point_2_x  |         |  float   |                               |
| geometry.point_2_y  |         |  float   |                               |
| geometry.point_3_x  |         |  float   |                               |
| geometry.point_3_y  |         |  float   |                               |
|     geometry.x      |         |  float   |                               |
|     geometry.y      |         |  float   |                               |
|     geometry.z      |         |  float   |                               |
|   geometry.z_span   |         |  float   | Restrained by condition: >0.  |
|   geometry.z_min    |         |  float   |                               |
|   geometry.z_max    |         |  float   |                               |
|  geometry.rotate_x  |    0    |  float   |                               |
|  geometry.rotate_y  |    0    |  float   |                               |
|  geometry.rotate_z  |    0    |  float   |                               |
|  material.material  |         | material |                               |
| material.mesh_order |         | integer  | Restrained by condition: >=0. |



## 3. Boundary/Mesh

### 3.1 Boundary

You can use the code in this section to add a set of default optical boundary's property to current project.

```python
OBoundary(
            self,
            *,
            pml_same_settings: bool = True,
            property: Union['OBoundarySameSettingsPostProcess', 'OBoundaryNotSameSettingsPostProcess'],
    )
```

|  **Parameters**   |                    Description                    |
| :---------------: | :-----------------------------------------------: |
|     property      |        Default optical boundary property.         |
| pml_same_settings | Use same pml settings on every directions or not. |

As demonstrated in the following examples, we also provide support for customizing boundary conditions in different directions. 

**Example:**

```python
st.OBoundary(property={'geometry': {'x': 0, 'x_span': 0, 'y': 0, 'y_span': yspan_solver, 'z': 0, 'z_span': zspan_solver},
                       'boundary': {'y_min': 'PML', 'y_max': 'PML', 'z_min': 'PML', 'z_max': 'PML'},
                       'general_pml': {'pml_layer': 12, 'pml_kappa': 1, 'pml_sigma': 15, 'pml_polynomial': 3}
                       })
```

|          **Parameters**          | Default  |  Type   |                            Notes                             |
| :------------------------------: | :------: | :-----: | :----------------------------------------------------------: |
|  general_pml.pml_same_settings   |   true   |  bool   |                                                              |
|     general_pml.pml_profile      | standard | string  |                                                              |
|      general_pml.pml_layer       |          | integer |                                                              |
|      general_pml.pml_kappa       |          |  float  |                                                              |
|      general_pml.pml_sigma       |          |  float  |                                                              |
|    general_pml.pml_polynomial    |          | integer |                                                              |
|      general_pml.pml_alpha       |          |  float  |                                                              |
| general_pml.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.pml_min_layers    |          | integer |                                                              |
|    general_pml.pml_max_layers    |          | integer |                                                              |
|            geometry.x            |          |  float  |                                                              |
|         geometry.x_span          |          |  float  |                Restrained by condition: >=0.                 |
|          geometry.x_min          |          |  float  |                                                              |
|          geometry.x_max          |          |  float  |                                                              |
|            geometry.y            |          |  float  |                                                              |
|         geometry.y_span          |          |  float  |                Restrained by condition: >=0.                 |
|          geometry.y_min          |          |  float  |                                                              |
|          geometry.y_max          |          |  float  |                                                              |
|            geometry.z            |          |  float  |                                                              |
|         geometry.z_span          |          |  float  |                Restrained by condition: >=0.                 |
|          geometry.z_min          |          |  float  |                                                              |
|          geometry.z_max          |          |  float  |                                                              |
|          boundary.x_max          |          | string  |  Selections are ['PML', 'PEC', 'metal', 'PMC', 'periodic'].  |
|          boundary.x_min          |          | string  | Selections are ['PML', 'PEC', 'metal', 'PMC', 'symmetric', 'anti_symmetric', 'periodic']. |
|          boundary.y_max          |          | string  |  Selections are ['PML', 'PEC', 'metal', 'PMC', 'periodic'].  |
|          boundary.y_min          |          | string  | Selections are ['PML', 'PEC', 'metal', 'PMC', 'symmetric', 'anti_symmetric', 'periodic']. |
|          boundary.z_max          |          | string  |  Selections are ['PML', 'PEC', 'metal', 'PMC', 'periodic'].  |
|          boundary.z_min          |          | string  | Selections are ['PML', 'PEC', 'metal', 'PMC', 'symmetric', 'anti_symmetric', 'periodic']. |



|              **Parameters**               | Default  |  Type   |                            Notes                             |
| :---------------------------------------: | :------: | :-----: | :----------------------------------------------------------: |
|       general_pml.pml_same_settings       |   true   |  bool   |                                                              |
|     general_pml.x_min_bc.pml_profile      | standard | string  |                                                              |
|      general_pml.x_min_bc.pml_layer       |          | integer |                                                              |
|      general_pml.x_min_bc.pml_kappa       |          |  float  |                                                              |
|      general_pml.x_min_bc.pml_sigma       |          |  float  |                                                              |
|    general_pml.x_min_bc.pml_polynomial    |          | integer |                                                              |
|      general_pml.x_min_bc.pml_alpha       |          |  float  |                                                              |
| general_pml.x_min_bc.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.x_min_bc.pml_min_layers    |          | integer |                                                              |
|    general_pml.x_min_bc.pml_max_layers    |          | integer |                                                              |
|     general_pml.x_max_bc.pml_profile      | standard | string  |                                                              |
|      general_pml.x_max_bc.pml_layer       |          | integer |                                                              |
|      general_pml.x_max_bc.pml_kappa       |          |  float  |                                                              |
|      general_pml.x_max_bc.pml_sigma       |          |  float  |                                                              |
|    general_pml.x_max_bc.pml_polynomial    |          | integer |                                                              |
|      general_pml.x_max_bc.pml_alpha       |          |  float  |                                                              |
| general_pml.x_max_bc.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.x_max_bc.pml_min_layers    |          | integer |                                                              |
|    general_pml.x_max_bc.pml_max_layers    |          | integer |                                                              |
|     general_pml.y_min_bc.pml_profile      | standard | string  |                                                              |
|      general_pml.y_min_bc.pml_layer       |          | integer |                                                              |
|      general_pml.y_min_bc.pml_kappa       |          |  float  |                                                              |
|      general_pml.y_min_bc.pml_sigma       |          |  float  |                                                              |
|    general_pml.y_min_bc.pml_polynomial    |          | integer |                                                              |
|      general_pml.y_min_bc.pml_alpha       |          |  float  |                                                              |
| general_pml.y_min_bc.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.y_min_bc.pml_min_layers    |          | integer |                                                              |
|    general_pml.y_min_bc.pml_max_layers    |          | integer |                                                              |
|     general_pml.y_max_bc.pml_profile      | standard | string  |                                                              |
|      general_pml.y_max_bc.pml_layer       |          | integer |                                                              |
|      general_pml.y_max_bc.pml_kappa       |          |  float  |                                                              |
|      general_pml.y_max_bc.pml_sigma       |          |  float  |                                                              |
|    general_pml.y_max_bc.pml_polynomial    |          | integer |                                                              |
|      general_pml.y_max_bc.pml_alpha       |          |  float  |                                                              |
| general_pml.y_max_bc.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.y_max_bc.pml_min_layers    |          | integer |                                                              |
|    general_pml.y_max_bc.pml_max_layers    |          | integer |                                                              |
|     general_pml.z_min_bc.pml_profile      | standard | string  |                                                              |
|      general_pml.z_min_bc.pml_layer       |          | integer |                                                              |
|      general_pml.z_min_bc.pml_kappa       |          |  float  |                                                              |
|      general_pml.z_min_bc.pml_sigma       |          |  float  |                                                              |
|    general_pml.z_min_bc.pml_polynomial    |          | integer |                                                              |
|      general_pml.z_min_bc.pml_alpha       |          |  float  |                                                              |
| general_pml.z_min_bc.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.z_min_bc.pml_min_layers    |          | integer |                                                              |
|    general_pml.z_min_bc.pml_max_layers    |          | integer |                                                              |
|     general_pml.z_max_bc.pml_profile      | standard | string  |                                                              |
|      general_pml.z_max_bc.pml_layer       |          | integer |                                                              |
|      general_pml.z_max_bc.pml_kappa       |          |  float  |                                                              |
|      general_pml.z_max_bc.pml_sigma       |          |  float  |                                                              |
|    general_pml.z_max_bc.pml_polynomial    |          | integer |                                                              |
|      general_pml.z_max_bc.pml_alpha       |          |  float  |                                                              |
| general_pml.z_max_bc.pml_alpha_polynomial |          | integer |                                                              |
|    general_pml.z_max_bc.pml_min_layers    |          | integer |                                                              |
|    general_pml.z_max_bc.pml_max_layers    |          | integer |                                                              |
|                geometry.x                 |          |  float  |                                                              |
|              geometry.x_span              |          |  float  |                Restrained by condition: >=0.                 |
|              geometry.x_min               |          |  float  |                                                              |
|              geometry.x_max               |          |  float  |                                                              |
|                geometry.y                 |          |  float  |                                                              |
|              geometry.y_span              |          |  float  |                Restrained by condition: >=0.                 |
|              geometry.y_min               |          |  float  |                                                              |
|              geometry.y_max               |          |  float  |                                                              |
|                geometry.z                 |          |  float  |                                                              |
|              geometry.z_span              |          |  float  |                Restrained by condition: >=0.                 |
|              geometry.z_min               |          |  float  |                                                              |
|              geometry.z_max               |          |  float  |                                                              |
|              boundary.x_max               |          | string  |  Selections are ['PML', 'PEC', 'metal', 'PMC', 'periodic'].  |
|              boundary.x_min               |          | string  | Selections are ['PML', 'PEC', 'metal', 'PMC', 'symmetric', 'anti_symmetric', 'periodic']. |
|              boundary.y_max               |          | string  |  Selections are ['PML', 'PEC', 'metal', 'PMC', 'periodic'].  |
|              boundary.y_min               |          | string  | Selections are ['PML', 'PEC', 'metal', 'PMC', 'symmetric', 'anti_symmetric', 'periodic']. |
|              boundary.z_max               |          | string  |  Selections are ['PML', 'PEC', 'metal', 'PMC', 'periodic'].  |
|              boundary.z_min               |          | string  | Selections are ['PML', 'PEC', 'metal', 'PMC', 'symmetric', 'anti_symmetric', 'periodic']. |



### 3.2 Mesh

#### 3.2.1 add_mesh

Add sub mesh.

```python
add_mesh(
            self,
            *,
            name: str,
            property: PostProcessSubMesh,
        )
```

| **Parameters** |  Description   |
| :------------: | :------------: |
|      name      |   Mesh name.   |
|    property    | Geometry type. |

**Example:**

```python
st.add_mesh(name='sub_mesh',
            property={'general': {'dx': 0.002, 'dy': 0.002, 'dz': 0.002},
                      'geometry': {'x': 0, 'x_span': 6, 'y': 0, 'y_span': 2, 'z': 0, 'z_span': 0.2}})
```

|     **Parameters**      | Default | Type  |             Notes             |
| :---------------------: | :-----: | :---: | :---------------------------: |
| general.override_x_mesh |         | bool  |                               |
| general.override_y_mesh |         | bool  |                               |
| general.override_z_mesh |         | bool  |                               |
|       general.dx        |         | float | Restrained by condition: >0.  |
|       general.dy        |         | float | Restrained by condition: >0.  |
|       general.dz        |         | float | Restrained by condition: >0.  |
|       geometry.x        |         | float |                               |
|     geometry.x_span     |         | float | Restrained by condition: >=0. |
|     geometry.x_min      |         | float |                               |
|     geometry.x_max      |         | float |                               |
|       geometry.y        |         | float |                               |
|     geometry.y_span     |         | float | Restrained by condition: >=0. |
|     geometry.y_min      |         | float |                               |
|     geometry.y_max      |         | float |                               |
|       geometry.z        |         | float |                               |
|     geometry.z_span     |         | float | Restrained by condition: >=0. |
|     geometry.z_min      |         | float |                               |
|     geometry.z_max      |         | float |                               |



#### 3.2.2 add_emesh

Add electric mesh.

```python
add_emesh(
            self,
            *,
            name: str,
            property: Dict[str, Any],
    	 )
```

| **Parameters** |          Description          |
| :------------: | :---------------------------: |
|      name      |   Electric local mesh name.   |
|    property    | Electric local mesh property. |

**Example:**

```python
st.add_emesh(name="EMesh_Local", property={
    "y_min": oe_y_min, "y_max": oe_y_max, "z_min": oe_z_min, "z_max": oe_z_max, "mesh_size": egrid_local})
```

| **Parameters** | Default | Type  |                 Notes                  |
| :------------: | :-----: | :---: | :------------------------------------: |
|       x        |         | float |                                        |
|     x_span     |         | float |     Restrained by condition: >=0.      |
|     x_min      |         | float |                                        |
|     x_max      |         | float |                                        |
|       y        |         | float |                                        |
|     y_span     |         | float |     Restrained by condition: >=0.      |
|     y_min      |         | float |                                        |
|     y_max      |         | float |                                        |
|       z        |         | float |                                        |
|     z_span     |         | float |     Restrained by condition: >=0.      |
|     z_min      |         | float |                                        |
|     z_max      |         | float |                                        |
|   mesh_size    |         | float | max size of electrical simulation mesh |



#### 3.2.3 add_emesh_along_line

Add electric mesh along line.

```python
add_emesh_along_line(
            self,
            *,
            name: str,
            property: Dict[str, Any],
    )
```

| **Parameters** |             Description             |
| :------------: | :---------------------------------: |
|      name      |   Electric  mesh along line name.   |
|    property    | Electric  mesh along line property. |

**Example:**

```python
st.add_emesh_along_line(name="EMesh_Ge_SiO2_Interface_Slope_Left", property={
    "start_x": oe_x_mean, "start_y": -Ge_y_span_bottom/2, "start_z": Si_z_span,
    "end_x": oe_x_mean, "end_y": -Ge_y_span_top/2, "end_z": Si_z_span+Ge_z_span,
    "mesh_size": egrid_interface})
```

| **Parameters** | Default | Type  |             Notes             |
| :------------: | :-----: | :---: | :---------------------------: |
|    start_x     |    0    | float |                               |
|    start_y     |    0    | float | Restrained by condition: >=0. |
|    start_z     |    0    | float |                               |
|     end_x      |    1    | float |                               |
|     end_y      |    1    | float |                               |
|     end_z      |    1    | float | Restrained by condition: >=0. |
|   mesh_size    |  0.01   | float |                               |





## 4. Source/Port

The following code will demonstrate how to add light source and  port in a simulation project.  

Currently, for the source module it supports the addition of modal sources and Gaussian sources. And we support to add ports in EME simulation and FDTD simulation. 

### 4.1 Mode source

Add a mode source into the project using code `type="mode_source"`.

```python
add(
            self,
            *,
            type: Literal["mode_source"],
            name: str,
            axis: AxisSelection,
            property: PostProcessModeSource,
    )
```

| **Parameters** |      Description      |
| :------------: | :-------------------: |
|      name      |   Mode source name.   |
|      type      |     Source type.      |
|      axis      |   Mode source axis.   |
|    property    | Mode source property. |

**Example:**

```python
src.add(name='source', type='mode_source', axis='x_forward',
                property={'general': {
                    # 'amplitude': 1, 'phase': 0, 'mode_index': 0, 'rotations': {'theta': 0, 'phi': 0, 'rotation_offset': 0}
                    'mode_selection': 'user_select', 'waveform': {'waveform_id_select': wv_struct}
                },
                    'geometry': {'x': ports['op_0']['position'][0], 'x_span': 0,
                                 'y': ports['op_0']['position'][1], 'y_span': monitor_w,
                                 'z': 0, 'z_span': monitor_h}})
```

|           **Parameters**            |  Default  |  Type   |                            Notes                             |
| :---------------------------------: | :-------: | :-----: | :----------------------------------------------------------: |
|         general.inject_axis         |  x_axis   | string  | Selections are ['x_axis', 'y_axis', 'z_axis', 'x', 'y', 'z']. |
|          general.direction          |  forward  | string  |           Selections are ['forward', 'backward'].            |
|          general.amplitude          |    1.0    |  float  |                                                              |
|            general.phase            |    0.0    |  float  |                                                              |
|       general.mode_selection        |           | string  | Selections are ['fundamental', 'fundamental_TE', 'fundamental_TM', 'fundamental_TE_and_TM', 'user_select', 'user_import']. |
|   general.mode_removal.threshold    |           |  float  |                                                              |
|         general.mode_index          |     0     | integer |                                                              |
|           general.search            | max_index | string  |           Selections are ['near_n', 'max_index'].            |
|              general.n              |    1.0    |  float  |                                                              |
|    general.number_of_trial_modes    |    20     | integer |                                                              |
| general.waveform.waveform_id_select |           |   any   |                                                              |
|       general.rotations.theta       |     0     |  float  |                                                              |
|        general.rotations.phi        |     0     |  float  |                                                              |
|  general.rotations.rotation_offset  |     0     |  float  |                                                              |
|             geometry.x              |           |  float  |                                                              |
|           geometry.x_span           |           |  float  |                Restrained by condition: >=0.                 |
|           geometry.x_min            |           |  float  |                                                              |
|           geometry.x_max            |           |  float  |                                                              |
|             geometry.y              |           |  float  |                                                              |
|           geometry.y_span           |           |  float  |                Restrained by condition: >=0.                 |
|           geometry.y_min            |           |  float  |                                                              |
|           geometry.y_max            |           |  float  |                                                              |
|             geometry.z              |           |  float  |                                                              |
|           geometry.z_span           |           |  float  |                Restrained by condition: >=0.                 |
|           geometry.z_min            |           |  float  |                                                              |
|           geometry.z_max            |           |  float  |                                                              |



### 4.2 Gaussian source

Add a Gaussian source into the project using code `type="mode_source"`.

```python
add(
            self,
            *,
            type: Literal["gaussian_source"],
            name: str,
            axis: AxisSelection,
            property: PostProcessGaussianSource,
    )
```

| **Parameters** |       Description        |
| :------------: | :----------------------: |
|      name      |  Gaussian source name.   |
|      type      |       Source type.       |
|      axis      |  Gaussian source axis.   |
|    property    | Gaussian source property |

**Example:**

```python
so.add(name='source', type='gaussian_source', axis='z_backward',
           property={'general': {'angle_theta': 12, 'angle_phi': 0, 'polarization_angle': 90, 'waveform': {'waveform_id_select': wv[waveform_name]},
                                 'beam_settings': {'calculation_method': 'use_scalar_approximation',  # [use_scalar_approximation,use_vector_approximation]
                                                   'beam_parameters': 'waist_size_and_position',  # [waist_size_and_position,beam_size_and_divergence]
                                                   'waist_radius': 5.2, 'distance_from_waist': 1.5, 'beam_radius': 5.2, 'divergence_angle': 5.41444}},
                     'geometry': {'x': 4, 'x_span': 20, 'y': 0, 'y_span': 20, 'z': 1.5, 'z_span': 0}})

```

|              **Parameters**               |         Default          |   Type   |                            Notes                             |
| :---------------------------------------: | :----------------------: | :------: | :----------------------------------------------------------: |
|            general.inject_axis            |          x_axis          |  string  | Selections are ['x_axis', 'y_axis', 'z_axis', 'x', 'y', 'z']. |
|             general.direction             |         forward          |  string  |           Selections are ['forward', 'backward'].            |
|             general.amplitude             |           1.0            |  float   |                                                              |
|               general.phase               |           0.0            |  float   |                                                              |
|    general.waveform.waveform_id_select    |                          | waveform |                                                              |
|            general.angle_theta            |            0             |  float   |                                                              |
|             general.angle_phi             |            0             |  float   |                                                              |
|          general.rotation_offset          |            0             |  float   |                                                              |
|        general.polarization_angle         |            0             |  float   |                                                              |
| general.beam_settings.calculation_method  | use_scalar_approximation |  string  | Selections are ['use_scalar_approximation', 'use_vector_approximation']. |
|   general.beam_settings.beam_parameters   | waist_size_and_position  |  string  | Selections are ['waist_size_and_position', 'beam_size_and_divergence']. |
|    general.beam_settings.waist_radius     |                          |  float   |                                                              |
| general.beam_settings.distance_from_waist |                          |  float   |                                                              |
|     general.beam_settings.beam_radius     |                          |  float   |                                                              |
|  general.beam_settings.divergence_angle   |                          |  float   |                                                              |
|                geometry.x                 |                          |  float   |                                                              |
|              geometry.x_span              |                          |  float   |                Restrained by condition: >=0.                 |
|              geometry.x_min               |                          |  float   |                                                              |
|              geometry.x_max               |                          |  float   |                                                              |
|                geometry.y                 |                          |  float   |                                                              |
|              geometry.y_span              |                          |  float   |                Restrained by condition: >=0.                 |
|              geometry.y_min               |                          |  float   |                                                              |
|              geometry.y_max               |                          |  float   |                                                              |
|                geometry.z                 |                          |  float   |                                                              |
|              geometry.z_span              |                          |  float   |                Restrained by condition: >=0.                 |
|              geometry.z_min               |                          |  float   |                                                              |
|              geometry.z_max               |                          |  float   |                                                              |

### 4.3 FDTD port

Add a port to current project.

```python
add(
            self,
            *,
            type: Literal["eme_port"],
            name: str,
            property: PostProcessEmePort,
    )
```

| **Parameters** |   Description   |
| :------------: | :-------------: |
|      name      | FDTD port name. |
|      type      |   Port type.    |
|    property    | FDTD port axis. |

**Example:**

```python
pt = pj.Port(property={'waveform_id': wv_struct, 'source_port': 'port_left'})
pt.add(name='port_left', type='fdtd_port',
       property={'geometry': {'x': ports['op_0']['position'][0], 'x_span': 0, 'y': ports['op_0']['position'][1],
                              'y_span': monitor_w, 'z': 0, 'z_span': monitor_h},
                 'modal_properties': {'general': {'inject_axis': 'x_axis', 'direction': 'forward',
									  'mode_selection': 'fundamental',
                                                                              }}})
```

|                 **Parameters**                  |      Default      |  Type   |                            Notes                             |
| :---------------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|                   geometry.x                    |                   |  float  |                                                              |
|                 geometry.x_span                 |                   |  float  |                Restrained by condition: >=0.                 |
|                 geometry.x_min                  |                   |  float  |                                                              |
|                 geometry.x_max                  |                   |  float  |                                                              |
|                   geometry.y                    |                   |  float  |                                                              |
|                 geometry.y_span                 |                   |  float  |                Restrained by condition: >=0.                 |
|                 geometry.y_min                  |                   |  float  |                                                              |
|                 geometry.y_max                  |                   |  float  |                                                              |
|                   geometry.z                    |                   |  float  |                                                              |
|                 geometry.z_span                 |                   |  float  |                Restrained by condition: >=0.                 |
|                 geometry.z_min                  |                   |  float  |                                                              |
|                 geometry.z_max                  |                   |  float  |                                                              |
|      modal_properties.general.inject_axis       |      x_axis       | string  | Selections are ['x_axis', 'y_axis', 'z_axis', 'x', 'y', 'z']. |
|       modal_properties.general.direction        |      forward      | string  |           Selections are ['forward', 'backward'].            |
|       modal_properties.general.amplitude        |         1         |  float  |                                                              |
|         modal_properties.general.phase          |         0         |  float  |                                                              |
|     modal_properties.general.mode_selection     |                   | string  | Selections are ['fundamental', 'fundamental_TE', 'fundamental_TM', 'fundamental_TE_and_TM', 'user_select', 'user_import']. |
| modal_properties.general.mode_removal.threshold |                   |  float  |                                                              |
|       modal_properties.general.mode_index       |         1         | integer |                                                              |
|         modal_properties.general.search         |     max_index     | string  |           Selections are ['near_n', 'max_index'].            |
|           modal_properties.general.n            |        1.0        |  float  |                                                              |
| modal_properties.general.number_of_trial_modes  |        20         | integer |                                                              |
| modal_properties.bent_waveguide.bent_waveguide  |       false       |  bool   |                                                              |
|     modal_properties.bent_waveguide.radius      |         1         |  float  |                                                              |
|   modal_properties.bent_waveguide.orientation   |        20         |  float  |                                                              |
|    modal_properties.bent_waveguide.location     | simulation_center | string  |            Selections are ['simulation_center'].             |





### 4.4 EME port

Add a port to current project.

```python
add(
            self,
            *,
            type: Literal["eme_port"],
            name: str,
            property: PostProcessEmePort,
    )
```

| **Parameters** |    Description     |
| :------------: | :----------------: |
|      name      |   EME port name.   |
|      type      |     Port type.     |
|    property    | EME port property. |

**Example:**

```python
pjp = pj.Port(property={"source_port": "input_te_tm"})
pjp.add(name="input_te_tm", type="eme_port",
        property={"geometry": {"port_location": "left", "use_full_simulation_span": True, "y": 1.256, "y_span": 8, "z": 0, "z_span": 6},
                  "eme_port": {"general": {"mode_selection": "fundamental_TE_and_TM", "mode_index": 1},
                               "advanced": {"offset": 0.1, "number_of_trial_modes": number_of_modes}}})
```

|              **Parameters**              |      Default      |  Type   |                            Notes                             |
| :--------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|          geometry.port_location          |                   | string  |              Selections are ['left', 'right'].               |
|    geometry.use_full_simulation_span     |       true        |  bool   |                                                              |
|                geometry.y                |                   |  float  |                                                              |
|             geometry.y_span              |                   |  float  |                Restrained by condition: >=0.                 |
|              geometry.y_min              |                   |  float  |                                                              |
|              geometry.y_max              |                   |  float  |                                                              |
|                geometry.z                |                   |  float  |                                                              |
|             geometry.z_span              |                   |  float  |                Restrained by condition: >=0.                 |
|              geometry.z_min              |                   |  float  |                                                              |
|              geometry.z_max              |                   |  float  |                                                              |
|     eme_port.general.mode_selection      |                   | string  | Selections are ['fundamental', 'fundamental_TE', 'fundamental_TM', 'fundamental_TE_and_TM', 'user_select', 'user_import']. |
|       eme_port.general.mode_index        |         1         | integer |                                                              |
|         eme_port.general.search          |     max_index     | string  |           Selections are ['near_n', 'max_index'].            |
|            eme_port.general.n            |        1.0        | integer |                                                              |
|  eme_port.bent_waveguide.bent_waveguide  |       false       |  bool   |                                                              |
|      eme_port.bent_waveguide.radius      |         1         |  float  |                                                              |
|   eme_port.bent_waveguide.orientation    |        20         |  float  |                                                              |
|     eme_port.bent_waveguide.location     | simulation_center | string  |            Selections are ['simulation_center'].             |
|         eme_port.advanced.offset         |         0         |  float  |                                                              |
| eme_port.advanced.number_of_trial_modes  |        20         | integer |                                                              |
| eme_port.advanced.mode_removal.threshold |                   |  float  |                                                              |









## 5. Monitor

This section will help you to add the monitor to one simulation project. We offer a range of monitors to assist you in obtaining simulation data more intuitively. The following will be presented in sequence to provide an introduction.

### 5.1 Profile monitor

Add a profile monitor to current project.

```python
add(
            self,
            *,
            type: Literal["profile_monitor"],
            name: str,
            property: PostProcessProfileMonitor,
    )
```

| **Parameters** |        Description        |
| :------------: | :-----------------------: |
|      name      |   Profile monitor name.   |
|      type      |       Monitor type.       |
|    property    | Profile monitor property. |

**Example:**

```python
mn = pj.Monitor()
mn.add(name="y_normal", type="profile_monitor",
       property={"geometry": {"monitor_type": "2d_y_normal", "x_resolution": 100,
                              "x": 0, "x_span": 206, "y": 0, "y_span": 0, "z": 0.5, "z_span": 7}})
```

|    **Parameters**     | Default |  Type   |                            Notes                             |
| :-------------------: | :-----: | :-----: | :----------------------------------------------------------: |
| geometry.monitor_type |         | string  | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal', 'x', 'y', 'z']. |
| geometry.x_resolution |   100   | integer |                                                              |
|      geometry.x       |         |  float  |                                                              |
|    geometry.x_span    |         |  float  |                Restrained by condition: >=0.                 |
|    geometry.x_min     |         |  float  |                                                              |
|    geometry.x_max     |         |  float  |                                                              |
|      geometry.y       |         |  float  |                                                              |
|    geometry.y_span    |         |  float  |                Restrained by condition: >=0.                 |
|    geometry.y_min     |         |  float  |                                                              |
|    geometry.y_max     |         |  float  |                                                              |
|      geometry.z       |         |  float  |                                                              |
|    geometry.z_span    |         |  float  |                Restrained by condition: >=0.                 |
|    geometry.z_min     |         |  float  |                                                              |
|    geometry.z_max     |         |  float  |                                                              |



### 5.2 Global monitor/Global option

Add a global monitor to current project.

```python
add(
            self,
            *,
            type: Literal["global_monitor", "global_option"],
            name: str,
            property: PostProcessGlobalMonitor,
    )
```

| **Parameters** |       Description        |
| :------------: | :----------------------: |
|      name      |   Global monitor name.   |
|      type      |      Monitor type.       |
|    property    | Global monitor property. |

**Example:**

```python
mn = pj.Monitor()
mn.add(name='Global Option', type='global_option',
       property={'frequency_power': {  # 'sample_spacing': 'uniform', 'use_wavelength_spacing': True,
           # ['min_max','center_span']
           'spacing_type': 'wavelength', 'spacing_limit': 'center_span',
           'wavelength_center': wavelength, 'wavelength_span': 0.1, 'frequency_points': 11}})
```

|             **Parameters**             |  Default   |  Type   |                    Notes                    |
| :------------------------------------: | :--------: | :-----: | :-----------------------------------------: |
|     frequency_power.sample_spacing     |  uniform   | string  |         Selections are ['uniform'].         |
| frequency_power.use_wavelength_spacing |    true    |  bool   |                                             |
|      frequency_power.spacing_type      | wavelength | string  | Selections are ['wavelength', 'frequency']. |
|     frequency_power.spacing_limit      |  min_max   | string  | Selections are ['min_max', 'center_span'].  |
|     frequency_power.wavelength_min     |            |  float  |                                             |
|     frequency_power.wavelength_max     |            |  float  |                                             |
|   frequency_power.wavelength_center    |            |  float  |                                             |
|    frequency_power.wavelength_span     |            |  float  |                                             |
|     frequency_power.frequency_min      |            |  float  |                                             |
|     frequency_power.frequency_max      |            |  float  |                                             |
|    frequency_power.frequency_center    |            |  float  |                                             |
|     frequency_power.frequency_span     |            |  float  |                                             |
|    frequency_power.frequency_points    |     5      | integer |                                             |
|    advanced.min_sampling_per_cycle     |     2      | integer |                                             |



### 5.3 Time monitor

Add a time monitor to current project.

```python
add(
            self,
            *,
            type: Literal["time_monitor"],
            name: str,
            property: PostProcessTimeMonitor,
    )
```

| **Parameters** |      Description       |
| :------------: | :--------------------: |
|      name      |   Time monitor name.   |
|      type      |     Monitor type.      |
|    property    | Time monitor property. |

**Example:**

```python
mn = pj.Monitor()
mn.add(name='time_monitor1', type='time_monitor',
           property={'general': {
               'stop_method': 'end_of_simulation', 'start_time': 0, 'stop_time': 100, 'number_of_snapshots': 0},
               'geometry': {'monitor_type': 'point', 'x': 0, 'x_span': 0, 'y': 0, 'y_span': 0, 'z': 0, 'z_span': 0},
               'advanced': {'sampling_rate': {'min_sampling_per_cycle': 10}}})
```

|                **Parameters**                 |      Default      |  Type   |                            Notes                             |
| :-------------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|              general.stop_method              | end_of_simulation | string  | Selections are ['end_of_simulation', 'choose_stop_time', 'choose_number_of_snapshots']. |
|              general.start_time               |         0         |  float  |                                                              |
|               general.stop_time               |       1000        |  float  |                                                              |
|          general.number_of_snapshots          |         0         | integer |                                                              |
|             geometry.monitor_type             |                   | string  | Selections are ['point', 'linear_x', 'linear_y', 'linear_z', '2d_x_normal', '2d_y_normal', '2d_z_normal', '3d']. |
|                  geometry.x                   |                   |  float  |                                                              |
|                geometry.x_span                |                   |  float  |                Restrained by condition: >=0.                 |
|                geometry.x_min                 |                   |  float  |                                                              |
|                geometry.x_max                 |                   |  float  |                                                              |
|                  geometry.y                   |                   |  float  |                                                              |
|                geometry.y_span                |                   |  float  |                Restrained by condition: >=0.                 |
|                geometry.y_min                 |                   |  float  |                                                              |
|                geometry.y_max                 |                   |  float  |                                                              |
|                  geometry.z                   |                   |  float  |                                                              |
|                geometry.z_span                |                   |  float  |                Restrained by condition: >=0.                 |
|                geometry.z_min                 |                   |  float  |                                                              |
|                geometry.z_max                 |                   |  float  |                                                              |
| advanced.sampling_rate.min_sampling_per_cycle |        10         | integer |                                                              |



### 5.4 Power monitor/Mode expansion

Add a power monitor to current project. Meanwhile, We can use  `'mode_expansion'` to calculate the mode expansion for its relative  power monitor.  

```python
add(
            self,
            *,
            type: Literal["power_monitor"],
            name: str,
            property: PostProcessPowerMonitor,
    )

```

| **Parameters** |    Description    |
| :------------: | :---------------: |
|      name      |   Monitor name.   |
|      type      |   Monitor type.   |
|    property    | Monitor property. |

**Example:**

```python
mn = pj.Monitor()
mn.add(name='through', type='power_monitor',
           property={'general': {'frequency_profile': {'wavelength_center': wavelength, 'wavelength_span': 0.1,
                                                       'frequency_points': 11}, },
                     'geometry': {'monitor_type': '2d_x_normal',
                                  'x': ports['op_1']['position'][0], 'x_span': 0, 'y': ports['op_1']['position'][1],
                                  'y_span': monitor_w, 'z': 0, 'z_span': monitor_h},
                     'mode_expansion': {"enable": True, 'direction': 'positive',
                                        'mode_calculation': {
                                            'mode_selection': 'user_select', 'mode_index': [0, 1, 2, 3],
                                            'override_global_monitor_setting': {'wavelength_center': wavelength, 'wavelength_span': 0.1, 'frequency_points': 11}}}})
```

|                        **Parameters**                        |      Default      |  Type   |                            Notes                             |
| :----------------------------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|                    geometry.monitor_type                     |                   | string  | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal', 'x', 'y', 'z']. |
|                          geometry.x                          |                   |  float  |                                                              |
|                       geometry.x_span                        |                   |  float  |                Restrained by condition: >=0.                 |
|                        geometry.x_min                        |                   |  float  |                                                              |
|                        geometry.x_max                        |                   |  float  |                                                              |
|                          geometry.y                          |                   |  float  |                                                              |
|                       geometry.y_span                        |                   |  float  |                Restrained by condition: >=0.                 |
|                        geometry.y_min                        |                   |  float  |                                                              |
|                        geometry.y_max                        |                   |  float  |                                                              |
|                          geometry.z                          |                   |  float  |                                                              |
|                       geometry.z_span                        |                   |  float  |                Restrained by condition: >=0.                 |
|                        geometry.z_min                        |                   |  float  |                                                              |
|                        geometry.z_max                        |                   |  float  |                                                              |
|                geometry.rotate_settings.theta                |         0         |  float  |              Restrained by condition: >-90,<90.              |
|                 geometry.rotate_settings.phi                 |         0         |  float  |             Restrained by condition: >=0,<=360.              |
|           geometry.rotate_settings.rotation_offset           |         0         |  float  |           Restrained by condition: >=-1e30,<=1e30.           |
|         mode_expansion.[]monitors_for_expansion.name         |                   | string  |                                                              |
|  mode_expansion.[]monitors_for_expansion.frequency_monitor   |                   | string  |                                                              |
|                   mode_expansion.direction                   |     positive      | string  |           Selections are ['positive', 'negative'].           |
|        mode_expansion.mode_calculation.mode_selection        |                   | string  | Selections are ['fundamental', 'fundamental_TE', 'fundamental_TM', 'user_select']. |
|          mode_expansion.mode_calculation.mode_index          |                   |  list   |                                                              |
|            mode_expansion.mode_calculation.search            |     max_index     | string  |           Selections are ['near_n', 'max_index'].            |
|              mode_expansion.mode_calculation.n               |        1.0        |  float  |                                                              |
|    mode_expansion.mode_calculation.number_of_trial_modes     |        20         | integer |                                                              |
|   mode_expansion.mode_calculation.override_global_options    |       false       |  bool   |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.sample_spacing |      uniform      | string  |                 Selections are ['uniform'].                  |
| mode_expansion.mode_calculation.override_global_monitor_setting.use_wavelength_spacing |       true        |  bool   |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.spacing_type |    wavelength     | string  |         Selections are ['wavelength', 'frequency'].          |
| mode_expansion.mode_calculation.override_global_monitor_setting.spacing_limit |      min_max      | string  |          Selections are ['min_max', 'center_span'].          |
| mode_expansion.mode_calculation.override_global_monitor_setting.wavelength_min |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.wavelength_max |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.wavelength_center |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.wavelength_span |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.frequency_min |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.frequency_max |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.frequency_center |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.frequency_span |                   |  float  |                                                              |
| mode_expansion.mode_calculation.override_global_monitor_setting.frequency_points |                   | integer |                                                              |
| mode_expansion.mode_calculation.bent_waveguide.bent_waveguide |       false       |  bool   |                                                              |
|    mode_expansion.mode_calculation.bent_waveguide.radius     |        1.0        |  float  |                                                              |
|  mode_expansion.mode_calculation.bent_waveguide.orientation  |        0.0        |  float  |                                                              |
|   mode_expansion.mode_calculation.bent_waveguide.location    | simulation_center | string  |            Selections are ['simulation_center'].             |



### 5.6 Band monitor

Add a band monitor to current project.

```python
add(
            self,
            *,
            type: Literal["band_monitor"],
            name: str,
            property: PostProcessBandMonitor,
    )
```

| **Parameters** |      Description       |
| :------------: | :--------------------: |
|      name      |   Band monitor name.   |
|      type      |     Monitor type.      |
|    property    | Band monitor property. |

**Example:**

```python
mn = pj.Monitor()   
mn.add(name="band_line", type="band_monitor", property={
    "geometry": {"monitor_type": "linear_z", "x": oe_x_mean, "x_span": 0, "y_min": 0, "y_max": 0, "z_min": oe_z_min, "z_max": oe_z_max,
                 "interpolate_accuracy": 9}})
# endregion
```

|        **Parameters**         | Default |  Type   |                        Notes                         |
| :---------------------------: | :-----: | :-----: | :--------------------------------------------------: |
|       general.record_ec       |  true   |  bool   |                                                      |
|       general.record_ev       |  true   |  bool   |                                                      |
|       general.record_ei       |  true   |  bool   |                                                      |
|      general.record_efn       |  true   |  bool   |                                                      |
|      general.record_efp       |  true   |  bool   |                                                      |
|      general.record_evac      |  true   |  bool   |                                                      |
|     geometry.monitor_type     |         | string  | Selections are ['linear_x', 'linear_y', 'linear_z']. |
|          geometry.x           |         |  float  |                                                      |
|        geometry.x_span        |         |  float  |            Restrained by condition: >=0.             |
|        geometry.x_min         |         |  float  |                                                      |
|        geometry.x_max         |         |  float  |                                                      |
|          geometry.y           |         |  float  |                                                      |
|        geometry.y_span        |         |  float  |            Restrained by condition: >=0.             |
|        geometry.y_min         |         |  float  |                                                      |
|        geometry.y_max         |         |  float  |                                                      |
|          geometry.z           |         |  float  |                                                      |
|        geometry.z_span        |         |  float  |            Restrained by condition: >=0.             |
|        geometry.z_min         |         |  float  |                                                      |
|        geometry.z_max         |         |  float  |                                                      |
| geometry.interpolate_accuracy |    1    | integer |        Restrained by condition: >=1 && <= 10.        |



### 5.7 Charge monitor

Add a charge monitor to current project.

```python
add(
            self,
            *,
            type: Literal["charge_monitor"],
            name: str,
            property: PostProcessChargeMonitor,
    )
```

| **Parameters** |       Description        |
| :------------: | :----------------------: |
|      name      |   Charge monitor name.   |
|      type      |      Monitor type.       |
|    property    | Charge monitor property. |

**Example:**

```python
mn = pj.Monitor()
mn.add(name="np_line_080nm", type="charge_monitor", property={
       "geometry": {"monitor_type": "linear_y", "x": st_x_mean, "x_span": st_x_span, "y_min": -0.4, "y_max": 0.4, "z": 0.08, "z_span": 0,
                      "interpolate_accuracy": 9}})
```

|         **Parameters**         | Default |  Type   |                            Notes                             |
| :----------------------------: | :-----: | :-----: | :----------------------------------------------------------: |
|    general.record_electrons    |  true   |  bool   |                                                              |
|      general.record_holes      |  true   |  bool   |                                                              |
| general.integrate_total_charge |  true   |  bool   | Available when monitor_type is in ['2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|     geometry.monitor_type      |         | string  | Selections are ['linear_x', 'linear_y', 'linear_z', '2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|           geometry.x           |         |  float  |                                                              |
|        geometry.x_span         |         |  float  |                Restrained by condition: >=0.                 |
|         geometry.x_min         |         |  float  |                                                              |
|         geometry.x_max         |         |  float  |                                                              |
|           geometry.y           |         |  float  |                                                              |
|        geometry.y_span         |         |  float  |                Restrained by condition: >=0.                 |
|         geometry.y_min         |         |  float  |                                                              |
|         geometry.y_max         |         |  float  |                                                              |
|           geometry.z           |         |  float  |                                                              |
|        geometry.z_span         |         |  float  |                Restrained by condition: >=0.                 |
|         geometry.z_min         |         |  float  |                                                              |
|         geometry.z_max         |         |  float  |                                                              |
| geometry.interpolate_accuracy  |    1    | integer |            Restrained by condition: >=1 && <= 10.            |



### 5.8 Electric monitor

Add a electric monitor to current project.

```python
add(
            self,
            *,
            type: Literal["electric_monitor"],
            name: str,
            property: PostProcessElectricMonitor,
    )
```

| **Parameters** |    Description     |
| :------------: | :----------------: |
|      name      |   EME port name.   |
|      type      |   EME port type.   |
|    property    | EME port property. |

**Example:**

```python
 mn = pj.Monitor()
 mn.add(name="electric_2d", type="electric_monitor", property={
        "geometry": {"monitor_type": "2d_x_normal", "x": oe_x_mean, "x_span": 0, "y_min": -Ge_y_span_bottom*3/4, "y_max": Ge_y_span_bottom*3/4, "z_min": 0, "z_max": Si_z_span+Ge_z_span,
                     "interpolate_accuracy": 6}})
```

|             **Parameters**             | Default |  Type   |                            Notes                             |
| :------------------------------------: | :-----: | :-----: | :----------------------------------------------------------: |
|     general.record_electrics_field     |  true   |  bool   |                                                              |
| general.record_electrostatic_potential |  true   |  bool   |                                                              |
|      general.calculate_net_charge      |  true   |  bool   | Available when monitor_type is in ['2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|         geometry.monitor_type          |         | string  | Selections are ['linear_x', 'linear_y', 'linear_z', '2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|               geometry.x               |         |  float  |                                                              |
|            geometry.x_span             |         |  float  |                Restrained by condition: >=0.                 |
|             geometry.x_min             |         |  float  |                                                              |
|             geometry.x_max             |         |  float  |                                                              |
|               geometry.y               |         |  float  |                                                              |
|            geometry.y_span             |         |  float  |                Restrained by condition: >=0.                 |
|             geometry.y_min             |         |  float  |                                                              |
|             geometry.y_max             |         |  float  |                                                              |
|               geometry.z               |         |  float  |                                                              |
|            geometry.z_span             |         |  float  |                Restrained by condition: >=0.                 |
|             geometry.z_min             |         |  float  |                                                              |
|             geometry.z_max             |         |  float  |                                                              |
|     geometry.interpolate_accuracy      |    1    | integer |            Restrained by condition: >=1 && <= 10.            |





## 6. Simulation

In the upcoming code section, we will present the examples of  simulation module, along with its parameter list. This will assist you in achieving a more comprehensive model simulation.

We will provide support for multiple simulation modules, including optical and electrical aspects, such as FDE, FDTD, OEDevice, and more.

```python
add(
            self,
            *,
            name: str,
            type: "SimulationTypeSelection",
            property: Any,
            **kwargs,
    )
```

| Parameters |                         Description                          |
| :--------: | :----------------------------------------------------------: |
|    name    |                       Simulation name.                       |
|    type    |                       Simulation type.                       |
|  location  |   Simulation run mode, cloud or local.Simulation property.   |
|  property  |                     Simulation property.                     |
|   kwargs   | Other simulation parameters. "source_name" is needed for "mode_selection:user_select" type simulation. |

### 6.1 FDE

Add a FDE solver to current project with the code `type='FDE'`. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["FDE"],
            property: FdePostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name=simu_name, type='FDE',
     property={
         # 'general': {'solver_type': '2d_x_normal'},  # default is '2d_x_normal' ['2d_x_normal','2d_y_normal','2d_z_normal']
         'mesh_settings': {
             'global_mesh_uniform_grid': {'dy': grid, 'dz': grid},  # 'minimum_mesh_step_settings': {'min_mesh_step': 1.0e-4}
         },
         'fde_analysis': {
             'modal_analysis': {
                 'calculate_modes': run_options.run, 'mesh_structure': True,
                 'wavelength': wavelength, 'wavelength_offset': 0.0001, 'number_of_trial_modes': number_of_trial_modes,
                 'search': 'max_index',  # ['near_n','max_index']
                 # 'n': 2,
                 'calculate_group_index': False,
                 'mode_removal': {'threshold': 0.02},
                 # 'bent_waveguide': {'bent_waveguide': False, 'radius': 1, 'orientation': 0, 'location': 'simulation_center'}
             },
             "frequency_analysis": {
                 "frequency_analysis": run_options.run_frequency_sweep,
                 "start_wavelength": 1.50, "stop_wavelength": 1.60, "number_of_points": 3,
                 "effective_index": 2.7, "detailed_dispersion_calculation": False
             }}})
```

|                          Parameters                          |      Default      |  Type   |                            Notes                             |
| :----------------------------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|                     general.solver_type                      |    2d_x_normal    | string  | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal', 'x', 'y', 'z']. |
|          mesh_settings.global_mesh_uniform_grid.dx           |       0.02        |  float  |                                                              |
|          mesh_settings.global_mesh_uniform_grid.dy           |       0.02        |  float  |                                                              |
|          mesh_settings.global_mesh_uniform_grid.dz           |       0.02        |  float  |                                                              |
|    mesh_settings.minimum_mesh_step_settings.min_mesh_step    |      0.0001       |  float  |                                                              |
|                    thread_setting.thread                     |         4         | integer |                                                              |
|          fde_analysis.modal_analysis.mesh_structure          |       false       |  bool   |                                                              |
|         fde_analysis.modal_analysis.calculate_modes          |       false       |  bool   |                                                              |
|  fde_analysis.modal_analysis.[]far_field_settings.calculate  |       true        |  bool   |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.mode_selection |                   | integer |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.projection_method |      planar       | string  |                  Selections are ['planar'].                  |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_filter |         0         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.material_index |        1.4        |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.projection_distance |      4430.65      |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.points_in_x |        50         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.points_in_y |        50         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_x  |         0         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_x_span |      26.1834      |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_y  |         0         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_y_span |      18.1231      |  float  |                                                              |
|            fde_analysis.modal_analysis.wavelength            |       1.55        |  float  |                                                              |
|        fde_analysis.modal_analysis.wavelength_offset         |       0.002       |  float  |                                                              |
|      fde_analysis.modal_analysis.number_of_trial_modes       |         5         | integer |                                                              |
|              fde_analysis.modal_analysis.search              |     max_index     | string  |           Selections are ['near_n', 'max_index'].            |
|                fde_analysis.modal_analysis.n                 |         1         |  float  |                                                              |
|      fde_analysis.modal_analysis.calculate_group_index       |       false       |  bool   |                                                              |
|  fde_analysis.modal_analysis.bent_waveguide.bent_waveguide   |       false       |  bool   |                                                              |
|      fde_analysis.modal_analysis.bent_waveguide.radius       |        0.0        |  float  |                                                              |
|    fde_analysis.modal_analysis.bent_waveguide.orientation    |        0.0        |  float  |                                                              |
|     fde_analysis.modal_analysis.bent_waveguide.location      | simulation_center | string  |            Selections are ['simulation_center'].             |
|      fde_analysis.modal_analysis.mode_removal.threshold      |                   |  float  |                                                              |
|      fde_analysis.frequency_analysis.frequency_analysis      |       false       |  bool   |                                                              |
|       fde_analysis.frequency_analysis.start_wavelength       |       1.55        |  float  |                                                              |
|       fde_analysis.frequency_analysis.stop_wavelength        |      1.49896      |  float  |                                                              |
|       fde_analysis.frequency_analysis.number_of_points       |        10         | integer |                                                              |
|       fde_analysis.frequency_analysis.effective_index        |        1.0        |  float  |                                                              |
| fde_analysis.frequency_analysis.detailed_dispersion_calculation |       false       |  bool   |                                                              |



#### 6.1.1 Mode selection

Add a mode selection to current project . 

```python
add(
            self,
            *,
            name: str,
            simulation_name: str,
            source_name: str = "",
            cell_group_index: int = 0,
            type: Literal["mode_selection:user_select"],
            property: ModeSelectionUserSelectPostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name=simu_name+'_cal_mode', simulation_name=simu_name, source_name='source', type='mode_selection:user_select',
                 property={'modal_analysis': {'calculate_modes': True, 'mesh_structure': True,
                                              'wavelength': wavelength, 'number_of_trial_modes': 20, 'search': 'max_index', 'calculate_group_index': True
                                              }})
        src_res = simu[f'{simu_name}_cal_mode'].run()
        src_res.extract(data='calculate_modes', savepath=f'{plot_path}{kL[2]}_Preview_SourceMode',
                        attribute='E', mode=0, real=True, imag=True, **export_options, show=False)
```

|                     Parameters                     |      Default      |  Type   |                  Notes                  |
| :------------------------------------------------: | :---------------: | :-----: | :-------------------------------------: |
|           modal_analysis.mesh_structure            |       false       |  bool   |                                         |
|           modal_analysis.calculate_modes           |       false       |  bool   |                                         |
|             modal_analysis.wavelength              |       1.55        |  float  |                                         |
|          modal_analysis.wavelength_offset          |       0.002       |  float  |                                         |
|        modal_analysis.number_of_trial_modes        |        20         | integer |                                         |
|               modal_analysis.search                |     max_index     | string  | Selections are ['near_n', 'max_index']. |
|                  modal_analysis.n                  |         1         |  float  |                                         |
|        modal_analysis.calculate_group_index        |       false       |  bool   |                                         |
|    modal_analysis.bent_waveguide.bent_waveguide    |       false       |  bool   |                                         |
|        modal_analysis.bent_waveguide.radius        |        1.0        |  float  |                                         |
|     modal_analysis.bent_waveguide.orientation      |        0.0        |  float  |                                         |
|       modal_analysis.bent_waveguide.location       | simulation_center | string  |  Selections are ['simulation_center'].  |
|       modal_analysis.mode_removal.threshold        |                   |  float  |                                         |
|       frequency_analysis.frequency_analysis        |       false       |  bool   |                                         |
|        frequency_analysis.start_wavelength         |       1.55        |  float  |                                         |
|         frequency_analysis.stop_wavelength         |      1.49896      |  float  |                                         |
|        frequency_analysis.number_of_points         |        10         | integer |                                         |
|         frequency_analysis.effective_index         |        1.0        |  float  |                                         |
| frequency_analysis.detailed_dispersion_calculation |       false       |  bool   |                                         |



#### 6.1.2 Beam overlap

To calculate the beam overlap in FDE module. 

Firstly, we need to get the results of FDE beam and extract it.

```python
run_fde_beam_and_extract(self, *, property, export_csv=False, show=False, savepath="")
```

| **Parameters** |                 Description                  |
| :------------: | :------------------------------------------: |
|    property    |                Beam settings                 |
|   export_csv   |    Whether to save csv, defaults to False    |
|      show      |    Show figure or not, defaults as False     |
|    savepath    | Save path of heatmap and csv, defaults to "" |

Then we can run FDE overlap function and extract result.

```python
run_fde_overlap_and_extract(self, *, property, savepath="a", export_csv=False)
```

| **Parameters** |               Description                |
| :------------: | :--------------------------------------: |
|    property    |             Overlap settings             |
|    savepath    |    Save path of csv, defaults to "a"     |
|   export_csv   | Whether to export csv, defaults to False |

**Example:**

```python
beam_res = simu[simu_name].run_fde_beam_and_extract(
                property={
                    "define_gaussian_beam_by": "waist_size_and_position", # [waist_size_and_position,beam_size_and_divergence],
                    "waist_radius": 10, "distance_from_waist": 0, "refractive_index": 1,
                    "theta": 0, "phi": 0, "polarization_angle": 0,
                    "sample_span": 10, "sample_resolution": 200},
                savepath=plot_path + 'beam_heatmap')
            overlap_res = simu[simu_name].run_fde_overlap_and_extract(
                property={"add_global_mode": {"task_path": beam_res.task_path, "mode": 0}, "mode": 0, "optimize_position": True},
                export_csv=True,
                savepath=plot_path + 'overlap')
```



#### 6.1.3 Bent Waveguide

To calculate the bent waveguide mode in FDE module. 

```python
simu = pj.Simulation()
    simu.add(name=simu_name, type='FDE',
             property={'general': {'solver_type': '2d_x_normal'},
                       'mesh_settings': {'global_mesh_uniform_grid': {'dy': grid, 'dz': grid}},
                       'fde_analysis': {
                           'modal_analysis': {
                               'calculate_modes': run_options.run, 'mesh_structure': True,
                               'wavelength': wavelength, 'wavelength_offset': 0.0001, 'number_of_trial_modes': number_of_trial_modes, 'calculate_group_index': True,
                               'bent_waveguide': {'bent_waveguide': True, 'radius': 5.25, 'orientation': 0, 'location': 'simulation_center'}}}})
```



#### 6.1.4 Far field

```python
simu = pj.Simulation()
simu.add(name=simu_name, type='FDE',
         property={'general': {'solver_type': '2d_z_normal'},
                   'mesh_settings': {'global_mesh_uniform_grid': {'dx': grid, 'dy': grid}},
                   'fde_analysis': {
                       'modal_analysis': {
                           'calculate_modes': run_options.run, 'mesh_structure': True,
                           'wavelength': wavelength, 'wavelength_offset': 0.0001, 'number_of_trial_modes': number_of_trial_modes,
                           'far_field_settings': [{'calculate': run_options.run_far_field, 'mode_selection': 0, 'material_index': 3.7, 'farfield_filter': 0,
                                                   'projection_distance': 8000, 'points_in_x': 50, 'points_in_y': 50,
                                                   'farfield_x_span': 40, 'farfield_y_span': 40, 'farfield_x': 0, 'farfield_y': 0}]}}})
```



### 6.2 EME

Add a EME solver to current project with the code `type='EME'`. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["EME"],
            property: EmePostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name=simu_name, type="EME",
         property={"general": {"wavelength": wavelength, "use_wavelength_sweep": True},
                   "eme_setup": {
                       "cell_geometry": {
                           "energy_conservation": "make_passive",  # ["none","make_passive"]
                           "cell_group_definition": [
                               {"span": 2, "cell_number": 1, "number_of_modes": number_of_modes, "sc": "none"},
                               {"span": 1, "cell_number": 1, "number_of_modes": number_of_modes, "sc": "none"},
                               {"span": 200, "cell_number": 30, "number_of_modes": number_of_modes, "sc": "sub_cell"},
                               {"span": 3, "cell_number": 1, "number_of_modes": number_of_modes, "sc": "none"}]}},
                   "transverse_mesh_setting": {"global_mesh_uniform_grid": {"dy": grid, "dz": grid}},
                   "eme_analysis": {
                       "eme_propagate": run_options.run,
                       "propagation_sweep": {"propagation_sweep": run_options.run_length_sweep,
                                             "parameter": "group_span_3", "start": 50, "stop": 250, "number_of_points": 5},
                       "select_source": {"phase": 0, "select_mode": "TE"}}})
```

|                          Parameters                          |   Default    |  Type   |                   Notes                    |
| :----------------------------------------------------------: | :----------: | :-----: | :----------------------------------------: |
|                      general.wavelength                      |              |  float  |                                            |
|                  general.wavelength_offset                   |    0.002     |  float  |                                            |
|                 general.use_wavelength_sweep                 |    false     |  bool   |                                            |
|         eme_setup.cell_geometry.energy_conservation          | make_passive | string  |  Selections are ['none', 'make_passive'].  |
|            eme_setup.cell_geometry.display_cells             |    false     |  bool   |                                            |
|            eme_setup.cell_geometry.display_groups            |    false     |  bool   |                                            |
|     eme_setup.cell_geometry.[]cell_group_definition.span     |              |  float  |                                            |
| eme_setup.cell_geometry.[]cell_group_definition.cell_number  |              | integer |                                            |
| eme_setup.cell_geometry.[]cell_group_definition.number_of_modes |              | integer |                                            |
|      eme_setup.cell_geometry.[]cell_group_definition.sc      |     none     | string  | Selections are ['none', 'sub_cell', 'sc']. |
|    eme_setup.cell_geometry.[]cell_group_definition.search    |  max_index   | string  |  Selections are ['near_n', 'max_index'].   |
|      eme_setup.cell_geometry.[]cell_group_definition.n       |     1.0      |  float  |                                            |
|     transverse_mesh_setting.global_mesh_uniform_grid.dx      |     0.02     |  float  |                                            |
|     transverse_mesh_setting.global_mesh_uniform_grid.dy      |     0.02     |  float  |                                            |
|     transverse_mesh_setting.global_mesh_uniform_grid.dz      |     0.02     |  float  |                                            |
| transverse_mesh_setting.minimum_mesh_step_settings.min_mesh_step |    0.0001    |  float  |                                            |
|            advanced.eme_settings.max_stored_modes            |     1000     | integer |                                            |
|                    thread_settings.thread                    |      4       | integer |                                            |
|                  eme_analysis.eme_propagate                  |    false     |  bool   |                                            |
|             eme_analysis.periodicity.periodicity             |    false     |  bool   |                                            |
| eme_analysis.periodicity.[]periodic_group_definition.start_cell_group |              | integer |                                            |
| eme_analysis.periodicity.[]periodic_group_definition.end_cell_group |              | integer |                                            |
| eme_analysis.periodicity.[]periodic_group_definition.periods |              | integer |                                            |
|       eme_analysis.propagation_sweep.propagation_sweep       |    false     |  bool   |                                            |
|           eme_analysis.propagation_sweep.parameter           | group_span_1 | string  |                                            |
|             eme_analysis.propagation_sweep.start             |      0       |  float  |                                            |
|             eme_analysis.propagation_sweep.stop              |      1       |  float  |                                            |
|       eme_analysis.propagation_sweep.number_of_points        |      3       | integer |                                            |
|        eme_analysis.wavelength_sweep.wavelength_sweep        |    false     |  bool   |                                            |
|             eme_analysis.wavelength_sweep.start              |     1.5      |  float  |                                            |
|              eme_analysis.wavelength_sweep.stop              |     1.6      |  float  |                                            |
|  eme_analysis.wavelength_sweep.number_of_wavelength_points   |      3       | integer |                                            |
|               eme_analysis.select_source.phase               |      0       |  float  |                                            |
|            eme_analysis.select_source.select_mode            |              |         |                                            |



#### 6.2.1 EME CellGroup Custom Setting

To set a customized EME cell group. 

```python
simu = pj.Simulation()
simu.add(name=simu_name, type="EME",
         property={"general": {"wavelength": wavelength, "use_wavelength_sweep": True},
                   "eme_setup": {"cell_geometry": {
                       "energy_conservation": "make_passive",
                       "cell_group_definition": [
                           {"span": 2.5, "cell_number": cell_number, "number_of_modes": 30, "sc": sc_method, "search": "max_index"},
                           {"span": 5.2, "cell_number": cell_number, "number_of_modes": 50, "sc": sc_method, "search": "max_index", "n": 1.5},
                           {"span": 2.5, "cell_number": cell_number, "number_of_modes": 30, "sc": sc_method, "search": "max_index"}]}},
                   "transverse_mesh_setting": {"global_mesh_uniform_grid": {"dy": grid, "dz": grid}},
                   "eme_analysis": {
                       "eme_propagate": run_options.run,
                       "propagation_sweep": {"propagation_sweep": run_options.run_length_sweep,
                                             "parameter": "group_span_2", "start": 41, "stop": 61, "number_of_points": 11},
                       "wavelength_sweep": {"wavelength_sweep": run_options.run_wavelength_sweep,
                                            "start": wavelength - 0.05, "stop": wavelength + 0.05, "number_of_wavelength_points": 11},
                       "select_source": {"phase": 0, "select_mode": "TE"}}})
```



#### 6.2.2 EME Periodic Structure

To set an EME Periodic Structure.

```python
simu = pj.Simulation()
simu.add(name=simu_name, type='EME',
         property={
             'general': {'wavelength': wavelength},
             'eme_setup': {'cell_geometry': {
                 'cell_group_definition': [
                     {'span': EME_marg, 'cell_number': 1, 'number_of_modes': 10, 'sc': 'none'},
                     {'span': wb, 'cell_number': 1, 'number_of_modes': 10, 'sc': 'none'},
                     {'span': ws, 'cell_number': 1, 'number_of_modes': 10, 'sc': 'none'},
                     {'span': EME_marg, 'cell_number': 1, 'number_of_modes': 10, 'sc': 'none'}]}},
             'transverse_mesh_setting': {'global_mesh_uniform_grid': {'dx':grid, 'dy': grid, 'dz': grid} },
             'eme_analysis': {
                 'eme_propagate': run_options.run,
                 'periodicity': {'periodicity': True,
                                 'periodic_group_definition': [{'start_cell_group': 1, 'end_cell_group': 2, 'periods': grating_periods}]}
             }})
```









### 6.3 FDTD

Add a FDTD solver to current project with the code `type='FDTD'`. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["FDTD"],
            property: FdtdPostProcess,
    ) 
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name=simu_name, type='FDTD',
     property={'general': {'simulation_time': 10000, },
               'mesh_settings': {'mesh_type': 'auto_non_uniform',
                                 'mesh_accuracy': {'cells_per_wavelength': grids_per_lambda},
                                 'minimum_mesh_step_settings': {'min_mesh_step': 1e-4}},
               # 'advanced_options': {'auto_shutoff': {'auto_shutoff_min': 1.00e-4, 'down_sample_time': 200}},
               # 'thread_setting': {'thread': 4}
               })
```

|                          Parameters                          |     Default      |  Type   |                      Notes                      |
| :----------------------------------------------------------: | :--------------: | :-----: | :---------------------------------------------: |
|              extra.fdtd_port_group.source_port               |                  | string  |                                                 |
|                      general.dimension                       |        3d        | string  |             Selections are ['3d'].              |
|           general.using_optical_path_estimate_time           |      false       |  bool   |                                                 |
|                   general.simulation_time                    |       1000       | integer |                                                 |
|                   mesh_settings.mesh_type                    | auto_non_uniform | string  | Selections are ['auto_non_uniform', 'uniform']. |
|       mesh_settings.mesh_accuracy.cells_per_wavelength       |        15        | integer |                                                 |
|             mesh_settings.mesh_step_settings.dx              |       0.1        |  float  |                                                 |
|             mesh_settings.mesh_step_settings.dy              |       0.1        |  float  |                                                 |
|             mesh_settings.mesh_step_settings.dz              |       0.1        |  float  |                                                 |
|    mesh_settings.minimum_mesh_step_settings.min_mesh_step    |      0.0001      |  float  |                                                 |
|       advanced_options.auto_shutoff.use_early_shutoff        |       true       |  bool   |                                                 |
|        advanced_options.auto_shutoff.auto_shutoff_min        |      1.0e-4      |  float  |                                                 |
|        advanced_options.auto_shutoff.down_sample_time        |       100        |  float  |                                                 |
| advanced_options.live_slice_filed_display_settings.show_field |      false       |  bool   |                                                 |
| advanced_options.live_slice_filed_display_settings.select_field_section |   2d_z_normal    | string  | Selections are ['2d_y_normal', '2d_z_normal'].  |
| advanced_options.live_slice_filed_display_settings.select_component |        ex        | string  |       Selections are ['ex', 'ey', 'ez'].        |
| advanced_options.live_slice_filed_display_settings.time_interval |       200        |  float  |                                                 |
| advanced_options.live_slice_filed_display_settings.position  |        0         |  float  |                                                 |
|                    thread_setting.thread                     |                  |         |                                                 |



#### 6.3.1 Far field

To calculate the far field in FDTD module. 

```python
fdtd_res = simu[simu_name].run()
        ff_res = fdtd_res.calculate(
            monitor_name="through",
            property={"wavelength": 1.31,
                      "far_field_settings": {
                          "general": {"projection_direction": "forward", "material_index": 1, "far_field_filter": 0,
                                      "resolution": {"horizontal_points": 100, "vertical_points": 100}}}})
```





### 6.4 Sweep:FDTD/FDE/EME

Add a sweep module to current project. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["FDTD:sweep", "FDE:sweep", "EME:sweep"],
            property: AnyParameterSweepPostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(type='FDTD:sweep', name='FDTDSweep', property={
    'simulation_name': simu_name,
    'sweep_type': 'values',
    'parameters': [{
        'variable': gap,
        'values': [0.45, 0.55, 0.65],
    }],

    'result': [
        {'name': resultL[0], 'result': 'through', 'component': 'T'},
        {'name': resultL[1], 'result': 'cross', 'component': 'T'},
        {'name': resultL[2], 'result': 'through_me', 'component': 'T_forward'},
        {'name': resultL[3], 'result': 'cross_me', 'component': 'T_forward'}
    ]
})
```

An example of FDE sweep is illustrated in the following code.

```python
simu = pj.Simulation()
simu.add(type="FDE:sweep", name="FDESweep", property={
        "simulation_name": simu_name,
        "sweep_type": "values",
        "parameters": [{"variable": width, "values": [0.5, 0.7, 0.9]}],
        "result": [{"name": result[0], "component": "mode2:neff", "result": "FDE:Structure Sweep"},
                     {"name": result[1], "component": "mode1:neff", "result": "FDE:Structure Sweep"},
                     {"name": result[2], "component": "mode1:loss", "result": "FDE:Structure Sweep"},
                  ]
    })
```

An example of EME sweep is illustrated in the following code.

```python
simu = pj.Simulation()
simu.add(
    type='EME:sweep',
    name='EMESweep',
    property={
        'simulation_name': simu_name,
        'parameters': [
            {'variable': gap, 'number_of_points': 3, 'start': 0.45, 'stop': 0.65}
        ],
        # 'sweep_type': 'values',
        # 'parameters': [ { 'variable': gap, 'values': [0.45, 0.55, 0.65] } ],
        'result': [
            {'name': 'SMatrix', 'component': 'S', 'result': 'S-Matrix'}
        ]
    },
)
```

|          Parameters           | Default |  Type   |                Notes                 |
| :---------------------------: | :-----: | :-----: | :----------------------------------: |
|        simulation_name        |         | string  |                                      |
|          sweep_type           | ranges  | string  | Selections are ['ranges', 'values']. |
|     []parameters.variable     |         |  float  |                                      |
|      []parameters.start       |         |  float  |                                      |
|       []parameters.stop       |         |  float  |                                      |
| []parameters.number_of_points |         | integer |                                      |
|      []parameters.values      |         |  list   |                                      |
|         []result.name         |         | string  |                                      |
|        []result.result        |         | string  |                                      |
|      []result.component       |         | string  |                                      |



### 6.5 AFDTD

Add an AFDTD solver to current project with the code `type='AFDTD'`. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["AFDTD"],
            property: FdtdPostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name="preview_fdtd", type="AFDTD", property={
    "mesh_settings": {"mesh_accuracy": {"cells_per_wavelength": cells_per_wavelength}}})
```

|                          Parameters                          |     Default      |  Type   |                      Notes                      |
| :----------------------------------------------------------: | :--------------: | :-----: | :---------------------------------------------: |
|              extra.fdtd_port_group.source_port               |                  | string  |                                                 |
|                      general.dimension                       |        3d        | string  |             Selections are ['3d'].              |
|           general.using_optical_path_estimate_time           |      false       |  bool   |                                                 |
|                   general.simulation_time                    |       1000       | integer |                                                 |
|                   mesh_settings.mesh_type                    | auto_non_uniform | string  | Selections are ['auto_non_uniform', 'uniform']. |
|       mesh_settings.mesh_accuracy.cells_per_wavelength       |        15        | integer |                                                 |
|             mesh_settings.mesh_step_settings.dx              |       0.1        |  float  |                                                 |
|             mesh_settings.mesh_step_settings.dy              |       0.1        |  float  |                                                 |
|             mesh_settings.mesh_step_settings.dz              |       0.1        |  float  |                                                 |
|    mesh_settings.minimum_mesh_step_settings.min_mesh_step    |      0.0001      |  float  |                                                 |
|       advanced_options.auto_shutoff.use_early_shutoff        |       true       |  bool   |                                                 |
|        advanced_options.auto_shutoff.auto_shutoff_min        |      1.0e-4      |  float  |                                                 |
|        advanced_options.auto_shutoff.down_sample_time        |       100        |  float  |                                                 |
| advanced_options.live_slice_filed_display_settings.show_field |      false       |  bool   |                                                 |
| advanced_options.live_slice_filed_display_settings.select_field_section |   2d_z_normal    | string  | Selections are ['2d_y_normal', '2d_z_normal'].  |
| advanced_options.live_slice_filed_display_settings.select_component |        ex        | string  |       Selections are ['ex', 'ey', 'ez'].        |
| advanced_options.live_slice_filed_display_settings.time_interval |       200        |  float  |                                                 |
| advanced_options.live_slice_filed_display_settings.position  |        0         |  float  |                                                 |
|                    thread_setting.thread                     |        4         | integer |                                                 |



### 6.6 AFDE

Add an AFDE solver to current project with the code `type='AFDE'`. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["AFDE"],
            property: AfdePostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name="preview_fde", type="AFDE", property={
    "mesh_settings": {"global_mesh_uniform_grid": {"dy": ogrid_global_y, "dz": ogrid_global_z}},
    "fde_analysis": {"modal_analysis": {"calculate_modes": False, "mesh_structure": False, "wavelength": wavelength},
                     "modulator_analysis": {"modulator_analysis": True, "wavelength": wavelength, "np_path": ""}},
    "other": {**Si_index_vs_doping}})
```

|                          Parameters                          |      Default      |  Type   |                            Notes                             |
| :----------------------------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|                     general.solver_type                      |    2d_x_normal    | string  | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal', 'x', 'y', 'z']. |
|          mesh_settings.global_mesh_uniform_grid.dx           |       0.02        |  float  |                                                              |
|          mesh_settings.global_mesh_uniform_grid.dy           |       0.02        |  float  |                                                              |
|          mesh_settings.global_mesh_uniform_grid.dz           |       0.02        |  float  |                                                              |
|    mesh_settings.minimum_mesh_step_settings.min_mesh_step    |      0.0001       |  float  |                                                              |
|                    thread_setting.thread                     |         4         | integer |                                                              |
|          fde_analysis.modal_analysis.mesh_structure          |       false       |  bool   |                                                              |
|         fde_analysis.modal_analysis.calculate_modes          |       false       |  bool   |                                                              |
|  fde_analysis.modal_analysis.[]far_field_settings.calculate  |       true        |  bool   |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.mode_selection |                   | integer |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.projection_method |      planar       | string  |                  Selections are ['planar'].                  |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_filter |         0         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.material_index |        1.4        |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.projection_distance |      4430.65      |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.points_in_x |        50         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.points_in_y |        50         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_x  |         0         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_x_span |      26.1834      |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_y  |         0         |  float  |                                                              |
| fde_analysis.modal_analysis.[]far_field_settings.farfield_y_span |      18.1231      |  float  |                                                              |
|            fde_analysis.modal_analysis.wavelength            |       1.55        |  float  |                                                              |
|        fde_analysis.modal_analysis.wavelength_offset         |       0.002       |  float  |                                                              |
|      fde_analysis.modal_analysis.number_of_trial_modes       |         5         | integer |                                                              |
|              fde_analysis.modal_analysis.search              |     max_index     | string  |           Selections are ['near_n', 'max_index'].            |
|                fde_analysis.modal_analysis.n                 |         1         |  float  |                                                              |
|      fde_analysis.modal_analysis.calculate_group_index       |       false       |  bool   |                                                              |
|  fde_analysis.modal_analysis.bent_waveguide.bent_waveguide   |       false       |  bool   |                                                              |
|      fde_analysis.modal_analysis.bent_waveguide.radius       |        0.0        |  float  |                                                              |
|    fde_analysis.modal_analysis.bent_waveguide.orientation    |        0.0        |  float  |                                                              |
|     fde_analysis.modal_analysis.bent_waveguide.location      | simulation_center | string  |            Selections are ['simulation_center'].             |
|      fde_analysis.modal_analysis.mode_removal.threshold      |                   |  float  |                                                              |
|      fde_analysis.frequency_analysis.frequency_analysis      |       false       |  bool   |                                                              |
|       fde_analysis.frequency_analysis.start_wavelength       |       1.55        |  float  |                                                              |
|       fde_analysis.frequency_analysis.stop_wavelength        |      1.49896      |  float  |                                                              |
|       fde_analysis.frequency_analysis.number_of_points       |        10         | integer |                                                              |
|       fde_analysis.frequency_analysis.effective_index        |        1.0        |  float  |                                                              |
| fde_analysis.frequency_analysis.detailed_dispersion_calculation |       false       |  bool   |                                                              |



### 6.7 OEDevice

Add an OEDevice solver to current project with the code `type='AFDE'`. 

```python
add(
            self,
            *,
            name: str,
            type: Literal["OEDevice"],
            property: OeDevicePostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name="preview_fdtd", type="AFDTD", property={
    "mesh_settings": {"mesh_accuracy": {"cells_per_wavelength": cells_per_wavelength}}})
simu.add(name="preview_oedevice", type="OEDevice", property={
    "geometry": {"dimension": "2d_x_normal", "x": oe_x_mean, "x_span": 0, "y": oe_y_mean, "y_span": oe_y_span, "z_min": oe_z_min, "z_max": oe_z_max},
    "genrate": {"genrate_path": "", "coordinate_unit": "m", "field_length_unit": "m", "source_fraction": source_fraction},
    "general": {"norm_length": normal_length, "solver_mode": "steady_state", "simulation_temperature": temperature},
    "advanced": {"non_linear_solver": "Newton", "linear_solver": "MUMPS", "max_iterations": 50}})
```

|                Parameters                |      Default      |  Type   |                            Notes                             |
| :--------------------------------------: | :---------------: | :-----: | :----------------------------------------------------------: |
|        general.simulation_region         |   Device_Region   | string  |              Selections are ['Device_Region'].               |
|           general.norm_length            |         1         |  float  |                                                              |
|           general.solver_mode            |   steady_state    | string  |    Selections are ['steady_state', 'transient', 'SSAC'].     |
|      general.temperature_dependence      |    Isothermal     | string  |                Selections are ['Isothermal'].                |
|      general.simulation_temperature      |        300        |  float  |                                                              |
|        advanced.non_linear_solver        |      Newton       | string  |                  Selections are ['Newton'].                  |
|          advanced.linear_solver          |       MUMPS       | string  |          Selections are ['MUMPS', ' LU', ' BCGS'].           |
|         advanced.use_quasi_fermi         |     disabled      | string  |           Selections are ['disabled', ' enabled'].           |
|             advanced.damping             |       none        | string  |            Selections are ['none', ' potential'].            |
|        advanced.potential_update         |         1         | integer |                                                              |
|          advanced.multi_threads          | let_solver_choose | string  |  Selections are ['let_solver_choose', 'set_thread_count'].   |
|          advanced.thread_count           |         4         | integer |                                                              |
|         advanced.max_iterations          |        30         | integer |                                                              |
|    advanced.use_global_max_iterations    |       false       | integer |               Selections are ['false', 'true']               |
|     advanced.poisson_max_iterations      |        30         | integer |                                                              |
|       advanced.ddm_max_iterations        |        30         | integer |                                                              |
|       advanced.relative_tolerance        |      1.0e-5       |  float  |                                                              |
|         advanced.tolerance_relax         |      1.0e+5       |  float  |                                                              |
|        advanced.divergence_factor        |      1.0e+25      |  float  |                                                              |
|           genrate.genrate_path           |                   | string  |                                                              |
|         genrate.source_fraction          |                   |  float  |                                                              |
|         genrate.coordinate_unit          |         m         | string  |           Selections are ['m', 'cm', 'um', 'nm'].            |
|        genrate.field_length_unit         |         m         | string  |           Selections are ['m', 'cm', 'um', 'nm'].            |
|            geometry.dimension            |    2d_x_normal    | string  | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|                geometry.x                |                   |  float  |                                                              |
|             geometry.x_span              |                   |  float  |                                                              |
|              geometry.x_min              |                   |  float  |                                                              |
|              geometry.x_max              |                   |  float  |                                                              |
|                geometry.y                |                   |  float  |                                                              |
|             geometry.y_span              |                   |  float  |                                                              |
|              geometry.y_min              |                   |  float  |                                                              |
|              geometry.y_max              |                   |  float  |                                                              |
|                geometry.z                |                   |  float  |                                                              |
|             geometry.z_span              |                   |  float  |                                                              |
|              geometry.z_min              |                   |  float  |                                                              |
|              geometry.z_max              |                   |  float  |                                                              |
|  small_signal_ac.perturbation_amplitude  |       0.001       |  float  |                                                              |
|    small_signal_ac.frequency_spacing     |      single       | string  |         Selections are ['single', 'linear', 'log'].          |
|        small_signal_ac.frequency         |      1.0e+6       |  float  |                                                              |
|     small_signal_ac.start_frequency      |      1.0e+06      |  float  |                                                              |
|      small_signal_ac.stop_frequency      |      1.0e+09      |  float  |                                                              |
|    small_signal_ac.frequency_interval    |    9.9999e+10     |  float  |                                                              |
|   small_signal_ac.num_frequency_points   |         2         | integer |                                                              |
|   small_signal_ac.log_start_frequency    |      1.0e+06      |  float  |                                                              |
|    small_signal_ac.log_stop_frequency    |      1.0e+10      |  float  |                                                              |
| small_signal_ac.log_num_frequency_points |         2         | integer |                                                              |



## 7. Preview

### 7.1 Run index

We can use the code below to preview the index of structure. 

```python
run_index(
            self,
            *,
            property: RunIndex,
            name: str,
            export_csv: bool = False,
            show: bool = False,
            savepath: str = 'a',
            export_n: bool = True,
            export_c: bool = False,
            max_index: Optional[int] = None,
            max_sigma: Optional[int] = None,
    )
```

| **Parameters** |                     Description                     |
| :------------: | :-------------------------------------------------: |
|    property    |              Index monitor properties.              |
|      name      |                    Monitor name.                    |
|   export_csv   |        Export csv or not. Default as False.         |
|      show      |        Show figure or not. Default as False.        |
|    savepath    |   Save path for csv and picture. Default as 'a'.    |
|    export_n    | Whether to export nx, ny, nz... . Default as True.  |
|    export_c    | Whether to export σx, σy, σz... . Default as False. |
|   max_index    | Maximum index of heatmap colorbar. Default as None. |
|   max_sigma    | Maximum sigma of heatmap colorbar. Default as None. |

**Example:**

```python
simu[simu_name].run_index(name=f'{simu_name}_x_0', savepath=f'{plot_path}{k}IndexPreview_x=0',
                                  # export_csv=False, show=False,
                                  property={'geometry': {'x': 0, 'x_span': 0, 'y': 0, 'y_span': 3, 'z': 0, 'z_span': 2}})
```

|      Parameters       | Default |  Type  |                            Notes                             |
| :-------------------: | :-----: | :----: | :----------------------------------------------------------: |
| geometry.monitor_type |         | string | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|      geometry.x       |         | float  |                                                              |
|    geometry.x_span    |         | float  |                Restrained by condition: >=0.                 |
|    geometry.x_min     |         | float  |                                                              |
|    geometry.x_max     |         | float  |                                                              |
|      geometry.y       |         | float  |                                                              |
|    geometry.y_span    |         | float  |                Restrained by condition: >=0.                 |
|    geometry.y_min     |         | float  |                                                              |
|    geometry.y_max     |         | float  |                                                              |
|      geometry.z       |         | float  |                                                              |
|    geometry.z_span    |         | float  |                Restrained by condition: >=0.                 |
|    geometry.z_min     |         | float  |                                                              |
|    geometry.z_max     |         | float  |                                                              |



### 7.2 Structure show and show 3D

Show structure. If there are Pyramid or Arc-Waveguide 3D type geometry in current structure manager, this method is invalid.

```python
structure_show(
            self,
            *,
            mode="XY",
            show: bool,
            savepath: str,
            fig_type: Literal["png", "svg"] = "png",
            simulation_name: Optional[str] = None,
            disabled_components: Tuple[
                Literal[
                    "materials",
                    "helpers",
                    "box",
                    "box.coordinate",
                    "box.cavity",
                    "ModeSource",
                    "PowerMonitor",
                    "ProfileMonitor",
                    "FDTDPortGroup",
                ],
                ...
            ] = tuple(),
            xyratio=(1, 1),
            celldisplay=False
    )
```

|                **Parameters**                |                         Description                          |
| :------------------------------------------: | :----------------------------------------------------------: |
|                     mode                     |                          Show mode.                          |
|                     show                     | Whether to show the picture. If set to False, the picture will be saved instead. |
|                   savepath                   |                      Picture save path.                      |
|                   fig_type                   |                    Picture suffix(type).                     |
|               simulation_name                |                       Simulation name.                       |
|             disabled_components              |               Disable components from showing.               |
| xyratioZoom multiplier of x and y direction. |            Zoom multiplier of x and y direction.             |
|                 celldisplay                  |                  Whether to show eme cells.                  |

Show 3D structure in a pop up windows.

```python
show3d(self, show_with: Literal["webviewer", "matplotlib"] = "webviewer")
```

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|   show_with    | "webviewer" will start a server and toggle a browser windows. "matplotlib" will toggle a Axes3D windows. Default as "webviewer". |

**Example:**

```python
st.structure_show(fig_type='png', show=False,
                  savepath=f'{plot_path}{kL[0]}{simu_name}', simulation_name=simu_name)
simu[simu_name].show3d(show_with="local_gui")
```



### 7.3 Run_doping

Run doping.

```python
run_doping(
            self,
            name: str,
            property: RunDopingPostProcess,
            norm: str,
            scale: str,
            superimpose: bool,
            show: bool,
            material_list: list,
            cmin: float,
            savepath: str
    )
```

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|    property    |                  Doping preview properties.                  |
|      name      |                     Doping preview name.                     |
|      show      |            Show figure or not. Default as False.             |
|    savepath    |               Save path for picture. Required.               |
|      norm      | Colorbar normalization. Selections are ['linear', 'log']. Default as 'linear'. |
|     scale      | Scale type. Selections are ['equal', 'auto']. Default as 'equal'. |
|  superimpose   |   Superimpose doping on structure or not. Default as True.   |
| material_list  |         Specified material type list. Default as [].         |
|  region_list   | Specified region name list. Default as []. Superior to material_list when not empty. |
|      cmax      | Maximum concentration of heatmap colorbar. Default as None.  |
|      cmin      | Minimum concentration of heatmap colorbar. Default as None.  |

**Example:**

```python
simu["preview_oedevice"].run_doping(name="x_in", property={
        "geometry": {"dimension": "2d_x_normal", "x": oe_x_mean, "x_span": 0, "y": oe_y_mean, "y_span": oe_y_span, "z_min": oe_z_min, "z_max": oe_z_max}},
        norm="log", scale="equal", superimpose=False, show=False,
        material_list=["Ge", "Si"], cmin=8e5, savepath=plot_path + simu_name + "_" + time_str + "doping_x_in")
```

|     Parameters     | Default |  Type  |                            Notes                             |
| :----------------: | :-----: | :----: | :----------------------------------------------------------: |
| geometry.dimension |         | string | Selections are ['2d_x_normal', '2d_y_normal', '2d_z_normal']. |
|     geometry.x     |         | float  |                                                              |
|  geometry.x_span   |         | float  |                Restrained by condition: >=0.                 |
|   geometry.x_min   |         | float  |                                                              |
|   geometry.x_max   |         | float  |                                                              |
|     geometry.y     |         | float  |                                                              |
|  geometry.y_span   |         | float  |                Restrained by condition: >=0.                 |
|   geometry.y_min   |         | float  |                                                              |
|   geometry.y_max   |         | float  |                                                              |
|     geometry.z     |         | float  |                                                              |
|  geometry.z_span   |         | float  |                Restrained by condition: >=0.                 |
|   geometry.z_min   |         | float  |                                                              |
|   geometry.z_max   |         | float  |                                                              |



## 8. Extract result

In this section, we will explore how to use code to extract simulation result data, exporting data results in various formats, enabling more effective data processing.

We support the atrributes to extract as below:

|                        **Parameters**                        |                         Description                          |
| :----------------------------------------------------------: | :----------------------------------------------------------: |
|                       PowerAttributes                        | Literal['E', 'Ex', 'Ey', 'Ez', 'H', 'Hx', 'Hy', 'Hz', 'Px', 'Py', 'Pz', 'Energy density'] |
|                        ModeAttributes                        | Literal["a", "b", "n", "p", "N", "P", "t_forward", "t_backward", "T_forward", "T_backward"] |
| Literal["TEratio", "neff_real", "neff_imag", "ng_real", "ng_imag", "wavelength_nm", "loss_dBpcm"] |                                                              |

| **Parameters** |                         Description                          |
| :------------: | :----------------------------------------------------------: |
|      data      |           Which type/field data will be extracted.           |
|   export_csv   |          Whether to export a csv. Default as False.          |
|      show      | Whether to show the picture. If set to False, the picture will be saved instead. Default as False. |
|    savepath    |              Picture save path. Default as 'a'.              |
|     target     |    How the data is organized/displayed. Default as None.     |
|   attribute    | Which attribute will extracted, in few cases this parameter is not needed. Default as None. |
|      real      |      Whether to add real part of data. Default as True.      |
|      imag      | Whether to add imag part of data. If both real and imag is activate, 'ABS' data will be extracted. Default as True. |
|     plot_x     |         selection of x axis of heatmap or line plot.         |
|     plot_y     |               selection of y axis of heatmap.                |
|     kwargs     | Other visualization parameters. 'monitor_name' and 'mode_expansion_name' for 'fdtd:mode_expansion' for example. |



### 8.1 FDE

To extract the data of FDE module. 

#### 8.1.1 Calculate mode result

Get the result of calculated mode.

```python
extract(
        self,
        *,
        # target - intensity
        data: Literal['calculate_modes'],
        attribute: PowerAttributes/ModeAttributes/OtherAttributes
        export_csv=False, export_mat=False, export_zbf=False, 
        show=False, 
        real=True, 
        imag=True, 
        savepath:Any = 'a',
        mode: int,
    )
```

**Example:**

```python
result_fde.extract(data='calculate_modes', savepath=f'{plot_path}{k}_mode{m}',
                   attribute='E', mode=m, real=True, imag=True, **export_options, show=False)
```



#### 8.1.2 Far-field FDE result

Get the result of  calculated far-field FDE.

```python
extract(
        self,
        *,
        # target - table
        data: Literal['farfield_fde'],
        attribute: PowerAttributes,
        
        show=False, 
        export_csv=False, export_mat=False, export_zbf=False, real=True, imag=True, savepath: Any = 'a',
        mode: int,
    )
```

**Example:**

```python
fde_res.extract(data='farfield_fde', savepath=f'{plot_path}05_{simu_name}_far_field',
                                attribute='E', mode=0, export_csv=True)
```



#### 8.1.3 Mesh structure result

To extract the result of meshing structure.

```python
extract(
        self,
        *,
        data: Literal['mesh_structure'],
        savepath:Any = 'a',
        target: Literal['intensity'] = 'intensity',
        export_csv=False, export_mat=False, export_zbf=False,
        show=False,
    )
```

**Example:**

```python
simu.add(name=simu_name+"_cal_mode", type="mode_selection:user_select", simulation_name=simu_name, source_name="source",
                 property={"modal_analysis": {"mesh_structure": True, "calculate_modes": True,
                                              "wavelength": wavelength, "number_of_trial_modes": 10, "search": "max_index", "calculate_group_index": True}})
```



#### 8.1.4 Frequency analysis result

To extract the result of frequency analysis.

```python
extract(
        self,
        *,
        target: Literal['line'] = 'line',
        data: Literal['frequency_analysis'],
        attribute: Literal['neff', 'group_index', 'loss', 'polarization'],
        
        export_csv=False, export_mat=False, export_zbf=False, 
        show=False, 
        real=True, 
        imag=True, 
        savepath:Any = 'a',
        plot_x: OptStr=None
    )
```

**Example:**

```python
result_fde.extract(data="frequency_analysis", savepath=f'{plot_path}{k}_freq_sweep_neff',
                                   attribute="neff", real=True, imag=True, export_csv=True, export_mat=True, show=False)

```



### 8.2 EME

To extract the relevant data of EME module. 

#### 8.2.1 EME propagate:facet data

Get the result of calculated facet data of EME propagation.

```python
extract(
            self,
            *,
            data: Literal[
                'eme_propagate:facet_data',
            ],
            export_csv=False, export_mat=False, export_zbf=False, real=True, imag=True, savepath: Any = 'a',
    )
```

**Example:**

```python
eme_res.extract(data='eme_propagate:facet_data', savepath=plot_path, real=True, imag=True, export_csv=True)
```



#### 8.2.2 EME propagate:monitor

Get the result of monitor data of EME propagation.

```
extract(
        self,
        *,
        data: Literal[
            'eme_propagate:monitor',
        ],
        attribute: PowerAttributes,
        monitor_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
eme_res.extract(
                data="eme_propagate:monitor", savepath=plot_path + "013_eme_y_normal",
                monitor_name="y_normal", attribute="E", export_csv=True)

```



#### 8.2.3 Propagation sweep:monitor

Get the result of monitor data of Propagation sweep.

```python
extract(
        self,
        *,
        data: Literal[
            'propagation_sweep:monitor',
        ],
        attribute: PowerAttributes,
        monitor_name: str,
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
eme_res.extract(data="eme_propagate:monitor", savepath=plot_path + "013_eme_z_normal",
                            monitor_name="z_normal", attribute="E", export_csv=True)

```



#### 8.2.4 Wavelength sweep:monitor

Get the result of monitor data of wavelength sweep.

```python
extract(
        self,
        *,
        data: Literal[
            'wavelength_sweep:monitor',
        ],
        attribute: PowerAttributes,
        monitor_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
eme_res.extract(data="wavelength_sweep:sweep", savepath=plot_path + "20_wavelength_sweep",
                            plot_x="wavelength", export_csv=True)
```



#### 8.2.5 EME propagate:smatrix

Get the result of smatrix data of EME propagation.

```python
extract(
        self,
        *,
        data: Literal[
            'eme_propagate:smatrix',
        ],
        target: Literal['intensity'] = 'intensity',
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
eme_res.extract(data="eme_propagate:smatrix", savepath=plot_path + "011_eme_smatrix_intensity",
                            target="intensity", export_csv=True)
```



#### 8.2.6 EME propagate:port mode infomation

Get the result of port mode data of EME propagation.

```python
extract(
        self,
        *,
        # target - intensity
        data: Literal['eme_propagate:port_mode_info'],
        target: Literal['intensity'] = 'intensity',
        attribute: Literal['E', 'H'],
        port_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
        mode: Any = None,
    )
```

**Example:**

```python
eme_res.extract(data="eme_propagate:smatrix", savepath=plot_path + "011_eme_smatrix_intensity",
                            target="intensity", export_csv=True)
```



#### 8.2.7 EME propagate:port mesh structure

Get the result of port mesh structure data of EME propagation.

```python
extract(
        self,
        *,
        # target - intensity
        data: Literal['eme_propagate:port_mesh_structure'],
        port_name: str,
        target: Literal['line', 'intensity'] = 'intensity',
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
eme_res.extract(data='eme_propagate:port_mesh_structure',
                                      savepath=f'{plot_path}{kL[3]}_eme_structure_{port_name}',
                                      port_name=port_name, target='intensity',
                                      # plot_x='y', plot_y='z', export_csv=False, show=False
                                      )
```



#### 8.2.8 EME propagate:cell mesh structure

Get the result of cell mesh structure data of EME propagation.

```python
extract(
        self,
        *,
        data: Literal[
            'eme_propagate:cell_mesh_structure',
        ],
        target: Literal["intensity", "line"],
        cell_params: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
eme_res.extract(data='eme_propagate:cell_mesh_structure',
                                      savepath=f'{plot_path}{kL[4]}_eme_c{cell_index}_index',
                                      cell_params='c' + str(cell_index), target='intensity', plot_x='y', plot_y='z',
                                      # export_csv=False, show=False
                                      )
```



### 8.3 FDTD

To extract the relevant data of FDTD module. 

#### 8.3.1 FDTD:power monitor

Get the result of power monitor data of FDTD.

```python
extract(
        self,
        *,
        data: Literal['fdtd:power_monitor'],
        target: Literal['intensity', 'line'],
        attribute: Union[PowerAttributes, Literal["T"]],
        monitor_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
        wavelength: Optional[Any] = None,
    )
```

**Example:**

```python
fdtd_res.extract(data='fdtd:power_monitor', savepath=f'{plot_path}{kL[6]}_TransVsLambda_power',
                         monitor_name='through', target='line', plot_x='wavelength', attribute='T', real=True, imag=False, export_csv=True, export_mat=True, show=False)
```



#### 8.3.2 FDTD:time monitor

Get the result of FDTD time monitor data.

```python
extract(
        self,
        *,
        data: Literal['fdtd:time_monitor'],
        target: Literal['intensity', 'line'],
        attribute: Union[PowerAttributes, Literal["T"]],
        monitor_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
        wavelength: Optional[Any] = None,
    )
```

**Example:**

```python
fdtd_res.extract(data='fdtd:time_monitor', savepath=f'{plot_path}{kL[6]}_TransVstime',
                         monitor_name='through', target='line', plot_x='time(fs)', attribute='E', real=True, imag=False, export_csv=True, export_mat=True, show=False)
```



#### 8.3.3 FDTD:mode expansion

Get the result of FDTD mode expansion data.

```python
extract(
        self,
        *,
        data: Literal['fdtd:mode_expansion'],
        target: Literal["intensity", "line"],
        attribute: ModeAttributes,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
        mode: Optional[Any] = None,
        wavelength: Optional[Any] = None,
        monitor_name: str,
        mode_expansion_name: str,
    )
```

**Example:**

```python
fdtd_res.extract(data='fdtd:mode_expansion', savepath=f'{plot_path}{kL[5]}_TransVsLambda_mode=0',
                         monitor_name='through', target='line', plot_x='wavelength', mode=0, attribute='T_forward', real=True, imag=True, export_csv=True, export_mat=True, show=False)

```



#### 8.3.4 FDTD:port mode information

Get the result of FDTD port mode information.

```python
extract(
        self,
        *,
        data: Literal['fdtd:port_mode_info'],
        target: Literal['intensity', 'line'],
        attribute: Literal['E', 'H', 'Loss', 'Neff', 'TE Polarization Fraction'],
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        port_name: str,
        mode: Any = None,
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
fdtd_res.extract(data='fdtd:port_mode_info', savepath=f'{plot_path}{kL[3]}_left_port_mode',
                             port_name='left_port', target='intensity', attribute='E', mode=0, export_csv=True)
```



#### 8.3.5 FDTD:mode source information

Get the result of FDTD mode source information.

```python
extract(
        self,
        *,
        data: Literal['fdtd:mode_source_mode_info'],
        target: Literal['intensity', 'line'],
        attribute: Literal['E', 'H', 'Loss', 'Neff', 'TE Polarization Fraction'],
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        source_name: str,
        mode: Any = None,
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

**Example:**

```python
fdtd_res.extract(data='fdtd:mode_source_mode_info', savepath=f'{plot_path}{kL[2]}_source_modeprofile',
                         source_name='source', target='intensity', attribute='E', mode=0, real=True, imag=True, **export_options, show=False)

```



#### 8.3.6 FDTD:mode expansion information

Get the result of FDTD mode expansion information.

```python
extract(
        self,
        *,
        data: Literal['fdtd:mode_expansion_mode_info'],
        target: Literal['intensity', 'line'],
        attribute: Literal['E', 'H', 'Loss', 'Neff', 'TE Polarization Fraction'],
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        monitor_name: str,
        mode_expansion_name: str,
        plot_x: OptStr=None, plot_y: OptStr=None,
        mode: Any = None,
        wavelength: Any = None,
        )
```

**Example:**

```python
fdtd_res.extract(data='fdtd:mode_expansion_mode_info', savepath=f'{plot_path}{kL[3]}_me_throughmode_info',
                         monitor_name='through', target='intensity', attribute='E', mode=0, wavelength=f'{wavelength}', real=True, imag=True, **export_options, show=False)
```



### 8.4 Sweep

To extract the relevant data of sweep function. 

#### 8.4.1 sweep

Get the result of sweep data.

```python
extract(
        self,
        *,
        data: Literal['sweep'],
        target: Literal['intensity', 'line'],
        attribute: str,
        monitor_name: Optional[str] = None,
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None,
        **kwargs,
    )
```

**Example:**

```python
swp_res.extract(data='sweep', target='line', attribute='S', plot_x='sweep_gap',
                        savepath=f'{plot_path}/01 S', export_csv=True)

```

```python
swp_res.extract(data='mode_expansion', target='line', attribute='T_forward', plot_x='sweep_gap', monitor_name='through',
                savepath=f'{plot_path}/03 {resultL[2]}', export_csv=True, )
```



#### 8.4.2 smatrix sweep

Get the result of smatrix sweep data.

```python
extract(
        self,
        *,
        data: Literal['smatrix_sweep'],
        target: Literal['intensity', 'line'],
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None,
    )
```

**Example:**

```python
smatrix_res.extract(data='smatrix_sweep', savepath=f'{plot_path}{kL[8]}_smatrix_sweep',
                            target='line', plot_x='wavelength', real=True, imag=True, export_csv=True, export_mat=True, show=False)
```



### 9. Other Fuction













































# 待整理




```
    @abstractmethod
    def calculate(
        self,
        *,
        simulation_name: str,
        monitor_name: str,
        property: FdtdCalculateMethodPropertyProcess,
        cmp_f: Optional[Callable] = None,
    ):
        """
        Calculate basing on the simulation result.

        :param monitor_name: monitor name
        :param property: properties for calculation
        :param simulation_name: simulation name
        :param cmp_f: compare function, defaults to None
        """
```



```
def extract(
        self,
        *,
        data: Literal[
            'eme_propagate:port_effective_index',
            'eme_propagate:port_ng',
        ],
        port_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
    ) 
```

```
def extract(
        self,
        *,
        data: Literal[
            'eme_propagate:port_overlap',
        ],
        target: Literal['line'] = 'line',
        port_name: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    ) 
```

```
extract(
        self,
        *,
        target: Literal['intensity'] = 'intensity',
        data: Literal[
            'eme_propagate:cell_mode_info',
        ],
        attribute: Literal['E', 'H'],
        cell_params: str,
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
        mode: Any = None,
    )
```

```
extract(
        self,
        *,
        data: Literal[
            'eme_propagate:prop_field',
        ],
        # target: intensity",
        attribute:PowerAttributes,
        cell_params: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```

```
extract(
        self,
        *,
        data: Literal[
            "eme_propagate:internal_s",
        ],
        target: Literal['intensity'] = 'intensity',
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    ) -> List[DataFrame]:
        ...
    
    
    @abstractmethod
    @overload
    def extract(
        self,
        *,
        data: Literal[
            "eme_propagate:cell_p_matrix",
            "eme_propagate:cell_overlap",
            "eme_propagate:cell_s",
            "eme_propagate:prop_s",
        ],
        target: Literal['intensity'] = 'intensity',
        cell_params: str,
        
        export_csv=False, export_mat=False, export_zbf=False, show=False, real=True, imag=True, savepath:Any = 'a',
        plot_x: OptStr=None, plot_y: OptStr=None,
    )
```




### 6.1.1 Mode selection

Integrate a mode selection into the current project.

```python
add(
            self,
            *,
            name: str,
            simulation_name: str,
            source_name: str = "",
            cell_group_index: int = 0,
            type: Literal["mode_selection:user_select"],
            property: ModeSelectionUserSelectPostProcess,
    )
```

**Example:**

```python
simu = pj.Simulation()
simu.add(name=simu_name+'_cal_mode', simulation_name=simu_name, source_name='source', type='mode_selection:user_select',
                 property={'modal_analysis': {'calculate_modes': True, 'mesh_structure': True,
                                              'wavelength': wavelength, 'number_of_trial_modes': 20, 'search': 'max_index', 'calculate_group_index': True
                                              }})
        src_res = simu[f'{simu_name}_cal_mode'].run()
        src_res.extract(data='calculate_modes', savepath=f'{plot_path}{kL[2]}_Preview_SourceMode',
                        attribute='E', mode=0, real=True, imag=True, **export_options, show=False)
```

|                     Parameters                     |      Default      |  Type   |                  Notes                  |
| :------------------------------------------------: | :---------------: | :-----: | :-------------------------------------: |
|           modal_analysis.mesh_structure            |       false       |  bool   |                                         |
|           modal_analysis.calculate_modes           |       false       |  bool   |                                         |
|             modal_analysis.wavelength              |       1.55        |  float  |                                         |
|          modal_analysis.wavelength_offset          |       0.002       |  float  |                                         |
|        modal_analysis.number_of_trial_modes        |        20         | integer |                                         |
|               modal_analysis.search                |     max_index     | string  | Selections are ['near_n', 'max_index']. |
|                  modal_analysis.n                  |         1         |  float  |                                         |
|        modal_analysis.calculate_group_index        |       false       |  bool   |                                         |
|    modal_analysis.bent_waveguide.bent_waveguide    |       false       |  bool   |                                         |
|        modal_analysis.bent_waveguide.radius        |        1.0        |  float  |                                         |
|     modal_analysis.bent_waveguide.orientation      |        0.0        |  float  |                                         |
|       modal_analysis.bent_waveguide.location       | simulation_center | string  |  Selections are ['simulation_center'].  |
|       modal_analysis.mode_removal.threshold        |                   |  float  |                                         |
|       frequency_analysis.frequency_analysis        |       false       |  bool   |                                         |
|        frequency_analysis.start_wavelength         |       1.55        |  float  |                                         |
|         frequency_analysis.stop_wavelength         |      1.49896      |  float  |                                         |
|        frequency_analysis.number_of_points         |        10         | integer |                                         |
|         frequency_analysis.effective_index         |        1.0        |  float  |                                         |
| frequency_analysis.detailed_dispersion_calculation |       false       |  bool   |                                         |
